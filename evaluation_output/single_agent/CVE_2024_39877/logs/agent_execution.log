2026-01-16 17:05:52,770 - orchestrator - INFO - Starting single-agent patching run for CVE-2024-39877
2026-01-16 17:05:52,770 - orchestrator - INFO - Starting single-agent patching run for CVE-2024-39877
2026-01-16 17:05:52,774 - orchestrator - INFO - Using container: single_agent_cve-2024-39877_05446c93, work_dir: /workspace/airflow
2026-01-16 17:05:52,774 - orchestrator - INFO - Using container: single_agent_cve-2024-39877_05446c93, work_dir: /workspace/airflow
2026-01-16 17:05:52,776 - src.agents.base - INFO - SingleAgent - LLM call prompt (2107 chars):
## Your Mission

Fix the security vulnerability in this codebase.

## Vulnerability Details

**CVE:** CVE-2024-39877
**CWE:** ['CWE-94', 'CWE-77', 'CWE-78']
**Affected File:** airflow/models/dag.py

**Vulnerable Locations:**
Not provided

### Description
No description provided. You'll need to investigate.

### Vulnerable Code Snippet (may be stale vs line numbers)
```Python
    def get_doc_md(self, doc_md: str | None) -> str | None:
        if doc_md is None:
            return doc_md

        env = self.get_template_env(force_sandboxed=True)

        if not doc_md.endswith(".md"):
            template = jinja2.Template(doc_md)
        else:
            try:
                template = env.get_template(doc_md)
            except jinja2.exceptions.TemplateNotFound:
                return f"""
                # Templating Error!
                Not able to find the template file: `{doc_md}`.
                """

        return template.render()
```

## Your Task

Execute the complete patching workflow autonomously:

1. **ANALYZE**: Read and understand the vulnerable code
   - Use ReadFile to examine the full file
   - Use FindClass to understand dependencies
   - Identify the root cause based on CWE/CVE information
   - Account for **all** listed vulnerable locations (multiple hunks/files may be affected)

2. **PLAN**: Formulate your fix strategy
   - Decide what needs to change and why
   - Consider security completeness and edge cases
   - Keep changes minimal and focused

3. **IMPLEMENT**: Apply the patch
   - Use EditCode to modify the vulnerable code
   - Ensure complete, valid, syntactically correct code
   - Preserve existing style and conventions

4. **VERIFY**: Run tests to validate
   - Use RunTest to execute PoC and unit tests
   - Read test output carefully to determine pass/fail
   - Verify both security fix and no regressions

5. **ITERATE**: If tests fail, adjust and retry
   - Analyze what went wrong
   - Try a different approach
   - Don't repeat the same mistake

You have all the tools and knowledge you need. Work autonomously and systematically.

Begin!

2026-01-16 17:05:52,776 - src.agents.base - INFO - SingleAgent - LLM call prompt (2107 chars):
## Your Mission

Fix the security vulnerability in this codebase.

## Vulnerability Details

**CVE:** CVE-2024-39877
**CWE:** ['CWE-94', 'CWE-77', 'CWE-78']
**Affected File:** airflow/models/dag.py

**Vulnerable Locations:**
Not provided

### Description
No description provided. You'll need to investigate.

### Vulnerable Code Snippet (may be stale vs line numbers)
```Python
    def get_doc_md(self, doc_md: str | None) -> str | None:
        if doc_md is None:
            return doc_md

        env = self.get_template_env(force_sandboxed=True)

        if not doc_md.endswith(".md"):
            template = jinja2.Template(doc_md)
        else:
            try:
                template = env.get_template(doc_md)
            except jinja2.exceptions.TemplateNotFound:
                return f"""
                # Templating Error!
                Not able to find the template file: `{doc_md}`.
                """

        return template.render()
```

## Your Task

Execute the complete patching workflow autonomously:

1. **ANALYZE**: Read and understand the vulnerable code
   - Use ReadFile to examine the full file
   - Use FindClass to understand dependencies
   - Identify the root cause based on CWE/CVE information
   - Account for **all** listed vulnerable locations (multiple hunks/files may be affected)

2. **PLAN**: Formulate your fix strategy
   - Decide what needs to change and why
   - Consider security completeness and edge cases
   - Keep changes minimal and focused

3. **IMPLEMENT**: Apply the patch
   - Use EditCode to modify the vulnerable code
   - Ensure complete, valid, syntactically correct code
   - Preserve existing style and conventions

4. **VERIFY**: Run tests to validate
   - Use RunTest to execute PoC and unit tests
   - Read test output carefully to determine pass/fail
   - Verify both security fix and no regressions

5. **ITERATE**: If tests fail, adjust and retry
   - Analyze what went wrong
   - Try a different approach
   - Don't repeat the same mistake

You have all the tools and knowledge you need. Work autonomously and systematically.

Begin!

2026-01-16 17:05:53,840 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:05:53,840 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:05:53,841 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 1,
  "end_line": 1000
}
2026-01-16 17:05:53,841 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 1,
  "end_line": 1000
}
2026-01-16 17:05:54,139 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:05:54,139 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:05:55,681 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:05:55,681 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:05:55,682 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "get_doc_md",
  "search_type": "all",
  "file_pattern": "airflow/models/dag.py"
}
2026-01-16 17:05:55,682 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "get_doc_md",
  "search_type": "all",
  "file_pattern": "airflow/models/dag.py"
}
2026-01-16 17:05:56,470 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:05:56,470 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:05:57,686 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:05:57,686 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:05:57,686 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "get_template_env",
  "search_type": "definition",
  "file_pattern": "airflow/models/dag.py"
}
2026-01-16 17:05:57,686 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "get_template_env",
  "search_type": "definition",
  "file_pattern": "airflow/models/dag.py"
}
2026-01-16 17:05:58,254 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:05:58,254 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:05:59,867 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:05:59,867 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:05:59,867 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "jinja2.Template",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:05:59,867 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "jinja2.Template",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:01,014 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:01,014 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:02,423 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:06:02,423 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:06:02,425 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "jinja2",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:02,425 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "jinja2",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:03,135 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:03,135 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:04,309 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:06:04,309 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:06:04,461 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "get_template_env",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:04,461 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "get_template_env",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:05,146 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:05,146 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:06,943 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:06:06,943 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:06:06,944 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 1760,
  "end_line": 1800
}
2026-01-16 17:06:06,944 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 1760,
  "end_line": 1800
}
2026-01-16 17:06:07,127 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:06:07,127 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:06:08,458 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:06:08,458 - src.agents.base - INFO - SingleAgent executing tool: FindClass
2026-01-16 17:06:08,459 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "SandboxedEnvironment",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:08,459 - src.agents.base - INFO - Tool arguments:
{
  "symbol_name": "SandboxedEnvironment",
  "search_type": "definition",
  "file_pattern": "*.py"
}
2026-01-16 17:06:09,383 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:09,383 - src.agents.base - INFO - Tool FindClass: ✓
2026-01-16 17:06:11,103 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:06:11,103 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:06:11,103 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/templates.py",
  "start_line": 40,
  "end_line": 80
}
2026-01-16 17:06:11,103 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/templates.py",
  "start_line": 40,
  "end_line": 80
}
2026-01-16 17:06:11,252 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:06:11,252 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:06:25,176 - src.agents.base - INFO - SingleAgent executing tool: EditCode
2026-01-16 17:06:25,176 - src.agents.base - INFO - SingleAgent executing tool: EditCode
2026-01-16 17:06:25,178 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "old_code": "    def get_doc_md(self, doc_md: str | None) -> str | None:\n        if doc_md is None:\n            return doc_md\n\n        env = self.get_template_env(force_sandboxed=True)\n\n        if not doc_md.endswith(\".md\"):\n            template = jinja2.Template(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return f\"\"\"\n                # Templating Error!\n                Not able to find the template file: `{doc_md}`.\n                \"\"\"\n\n        return template.render()",
  "new_code": "    def get_doc_md(self, doc_md: str | None) -> str | None:\n        if doc_md is None:\n            return doc_md\n\n        env = self.get_template_env(force_sandboxed=True)\n\n        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return f\"\"\"\n                # Templating Error!\n                Not able to find the template file: `{doc_md}`.\n                \"\"\"\n\n        return template.render()",
  "fuzzy_match": true,
  "skip_validation": false
}
2026-01-16 17:06:25,178 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "old_code": "    def get_doc_md(self, doc_md: str | None) -> str | None:\n        if doc_md is None:\n            return doc_md\n\n        env = self.get_template_env(force_sandboxed=True)\n\n        if not doc_md.endswith(\".md\"):\n            template = jinja2.Template(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return f\"\"\"\n                # Templating Error!\n                Not able to find the template file: `{doc_md}`.\n                \"\"\"\n\n        return template.render()",
  "new_code": "    def get_doc_md(self, doc_md: str | None) -> str | None:\n        if doc_md is None:\n            return doc_md\n\n        env = self.get_template_env(force_sandboxed=True)\n\n        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return f\"\"\"\n                # Templating Error!\n                Not able to find the template file: `{doc_md}`.\n                \"\"\"\n\n        return template.render()",
  "fuzzy_match": true,
  "skip_validation": false
}
2026-01-16 17:06:26,059 - src.tools.edit_code - INFO - EditCodeTool: Writing 175910 chars to airflow/models/dag.py (match_type=exact)
2026-01-16 17:06:26,059 - src.tools.edit_code - INFO - EditCodeTool: Writing 175910 chars to airflow/models/dag.py (match_type=exact)
2026-01-16 17:06:26,213 - src.agents.base - INFO - Tool EditCode: ✓
2026-01-16 17:06:26,213 - src.agents.base - INFO - Tool EditCode: ✓
2026-01-16 17:06:28,024 - src.agents.base - INFO - SingleAgent executing tool: RunTest
2026-01-16 17:06:28,024 - src.agents.base - INFO - SingleAgent executing tool: RunTest
2026-01-16 17:06:28,024 - src.agents.base - INFO - Tool arguments:
{
  "run_prepare": true,
  "timeout": 180,
  "include_paths": [
    "airflow/models/dag.py"
  ],
  "run_unittest": true
}
2026-01-16 17:06:28,024 - src.agents.base - INFO - Tool arguments:
{
  "run_prepare": true,
  "timeout": 180,
  "include_paths": [
    "airflow/models/dag.py"
  ],
  "run_unittest": true
}
2026-01-16 17:06:28,364 - src.tools.run_test - INFO - Extracted 1 file paths from /workspace/test.patch: ['tests/models/test_dag.py']
2026-01-16 17:06:28,364 - src.tools.run_test - INFO - Extracted 1 file paths from /workspace/test.patch: ['tests/models/test_dag.py']
2026-01-16 17:06:28,364 - src.tools.run_test - INFO - Generating git diff for fix.patch
2026-01-16 17:06:28,364 - src.tools.run_test - INFO - Generating git diff for fix.patch
2026-01-16 17:06:28,364 - src.tools.run_test - INFO -   include_paths: ['airflow/models/dag.py']
2026-01-16 17:06:28,364 - src.tools.run_test - INFO -   include_paths: ['airflow/models/dag.py']
2026-01-16 17:06:28,364 - src.tools.run_test - INFO -   exclude_paths (from test.patch): ['tests/models/test_dag.py']
2026-01-16 17:06:28,364 - src.tools.run_test - INFO -   exclude_paths (from test.patch): ['tests/models/test_dag.py']
2026-01-16 17:06:28,364 - src.tools.run_test - INFO -   git diff command: git diff HEAD -- 'airflow/models/dag.py' ':(exclude)tests/models/test_dag.py'
2026-01-16 17:06:28,364 - src.tools.run_test - INFO -   git diff command: git diff HEAD -- 'airflow/models/dag.py' ':(exclude)tests/models/test_dag.py'
2026-01-16 17:06:28,530 - src.tools.run_test - INFO -   Generated patch: 473 bytes, 13 lines
2026-01-16 17:06:28,530 - src.tools.run_test - INFO -   Generated patch: 473 bytes, 13 lines
2026-01-16 17:06:28,531 - src.tools.run_test - INFO -   Patch content:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..b55449f 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,7 +775,7 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)

2026-01-16 17:06:28,531 - src.tools.run_test - INFO -   Patch content:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..b55449f 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,7 +775,7 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)

2026-01-16 17:06:28,612 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:06:28,612 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:06:30,821 - src.tools.run_test - INFO - Running fix-run.sh for PoC validation...
2026-01-16 17:06:30,821 - src.tools.run_test - INFO - Running fix-run.sh for PoC validation...
2026-01-16 17:06:30,917 - src.tools.run_test - INFO - Patch being tested:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..b55449f 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,7 +775,7 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)


2026-01-16 17:06:30,917 - src.tools.run_test - INFO - Patch being tested:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..b55449f 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,7 +775,7 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)


2026-01-16 17:06:34,052 - src.tools.run_test - INFO - fix-run.sh completed with exit code 1
2026-01-16 17:06:34,052 - src.tools.run_test - INFO - fix-run.sh completed with exit code 1
2026-01-16 17:06:34,052 - src.tools.run_test - INFO - fix-run.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 251 deselected / 1 selected

models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered FAILED [100%]

=================================== FAILURES ===================================
____ TestDagDecorator.test_resolve_documentation_template_file_not_rendered ____

self = <tests.models.test_dag.TestDagDecorator object at 0x7ffff3ef85e0>
tmp_path = PosixPath('/tmp/pytest-of-root/pytest-0/test_resolve_documentation_tem0')

    def test_resolve_documentation_template_file_not_rendered(self, tmp_path):
        """Test that @dag uses function docs as doc_md for DAG object"""
    
        raw_content = """
        {% if True %}
            External Markdown DAG documentation
        {% endif %}
        """
    
        path = tmp_path / "testfile.md"
        path.write_text(raw_content)
    
        @dag_decorator("test-dag", start_date=DEFAULT_DATE, doc_md=str(path))
        def markdown_docs(): ...
    
        dag = markdown_docs()
        assert isinstance(dag, DAG)
        assert dag.dag_id == "test-dag"
>       assert dag.doc_md == raw_content
E       AssertionError: assert equals failed
E          -'\n                # Templating   +'\n        {% if True %}\n      
E          - Error!\n                Not ab   +       External Markdown DAG do 
E          -le to find the template file: `   +cumentation\n        {% endif % 
E          -/tmp/pytest-of-root/pytest-0/te   +}\n        '                    
E          -st_resolve_documentation_tem0/t                                  
E          -estfile.md`.\n                '

models/test_dag.py:3295: AssertionError
---------------------------- Captured stdout setup -----------------------------
========================= AIRFLOW ==========================
Home of the user: /root
Airflow home /root/airflow
Skipping initializing of the DB as it was initialized already.
You can re-initialize the database by adding --with-db-init flag when running tests.
=========================== short test summary info ============================
FAILED models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered - AssertionError: assert equals failed
   -'\n                # Templating   +'\n        {% if True %}\n      
   - Error!\n                Not ab   +       External Markdown DAG do 
   -le to find the template file: `   +cumentation\n        {% endif % 
   -/tmp/pytest-of-root/pytest-0/te   +}\n        '                    
   -st_resolve_documentation_tem0/t                                  
   -estfile.md`.\n                '
====================== 1 failed, 251 deselected in 2.07s =======================

2026-01-16 17:06:34,052 - src.tools.run_test - INFO - fix-run.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 251 deselected / 1 selected

models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered FAILED [100%]

=================================== FAILURES ===================================
____ TestDagDecorator.test_resolve_documentation_template_file_not_rendered ____

self = <tests.models.test_dag.TestDagDecorator object at 0x7ffff3ef85e0>
tmp_path = PosixPath('/tmp/pytest-of-root/pytest-0/test_resolve_documentation_tem0')

    def test_resolve_documentation_template_file_not_rendered(self, tmp_path):
        """Test that @dag uses function docs as doc_md for DAG object"""
    
        raw_content = """
        {% if True %}
            External Markdown DAG documentation
        {% endif %}
        """
    
        path = tmp_path / "testfile.md"
        path.write_text(raw_content)
    
        @dag_decorator("test-dag", start_date=DEFAULT_DATE, doc_md=str(path))
        def markdown_docs(): ...
    
        dag = markdown_docs()
        assert isinstance(dag, DAG)
        assert dag.dag_id == "test-dag"
>       assert dag.doc_md == raw_content
E       AssertionError: assert equals failed
E          -'\n                # Templating   +'\n        {% if True %}\n      
E          - Error!\n                Not ab   +       External Markdown DAG do 
E          -le to find the template file: `   +cumentation\n        {% endif % 
E          -/tmp/pytest-of-root/pytest-0/te   +}\n        '                    
E          -st_resolve_documentation_tem0/t                                  
E          -estfile.md`.\n                '

models/test_dag.py:3295: AssertionError
---------------------------- Captured stdout setup -----------------------------
========================= AIRFLOW ==========================
Home of the user: /root
Airflow home /root/airflow
Skipping initializing of the DB as it was initialized already.
You can re-initialize the database by adding --with-db-init flag when running tests.
=========================== short test summary info ============================
FAILED models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered - AssertionError: assert equals failed
   -'\n                # Templating   +'\n        {% if True %}\n      
   - Error!\n                Not ab   +       External Markdown DAG do 
   -le to find the template file: `   +cumentation\n        {% endif % 
   -/tmp/pytest-of-root/pytest-0/te   +}\n        '                    
   -st_resolve_documentation_tem0/t                                  
   -estfile.md`.\n                '
====================== 1 failed, 251 deselected in 2.07s =======================

2026-01-16 17:06:34,150 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:06:34,150 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:06:34,974 - src.tools.run_test - INFO - Running unit_test.sh for regression testing...
2026-01-16 17:06:34,974 - src.tools.run_test - INFO - Running unit_test.sh for regression testing...
2026-01-16 17:06:41,764 - src.tools.run_test - INFO - unit_test.sh completed with exit code 0
2026-01-16 17:06:41,764 - src.tools.run_test - INFO - unit_test.sh completed with exit code 0
2026-01-16 17:06:41,765 - src.tools.run_test - INFO - unit_test.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 1 deselected / 251 selected

models/test_dag.py::TestDag::test_params_not_passed_is_empty_dict PASSED [  0%]
models/test_dag.py::TestDag::test_params_passed_and_params_in_default_args_no_override PASSED [  0%]
models/test_dag.py::TestDag::test_not_none_schedule_with_non_default_params PASSED [  1%]
models/test_dag.py::TestDag::test_dag_invalid_default_view PASSED        [  1%]
models/test_dag.py::TestDag::test_dag_default_view_default_value PASSED  [  1%]
models/test_dag.py::TestDag::test_dag_invalid_orientation PASSED         [  2%]
models/test_dag.py::TestDag::test_dag_orientation_default_value PASSED   [  2%]
models/test_dag.py::TestDag::test_dag_as_context_manager PASSED          [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_include_subdag_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_dag_without_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_naive_start_date_string PASSED     [  4%]
models/test_dag.py::TestDag::test_dag_naive_start_end_dates_strings PASSED [  4%]
models/test_dag.py::TestDag::test_dag_start_date_propagates_to_end_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_none_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total PASSED  [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_upstream PASSED [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_absolute PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_invalid_weight_rule PASSED    [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[StaticTestPriorityWeightStrategy-99] PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[FactorPriorityWeightStrategy-3] PASSED [  8%]
models/test_dag.py::TestDag::test_dag_task_not_registered_weight_strategy PASSED [  8%]
models/test_dag.py::TestDag::test_get_num_task_instances PASSED          [  9%]
models/test_dag.py::TestDag::test_get_task_instances_before PASSED       [  9%]
models/test_dag.py::TestDag::test_user_defined_filters_macros PASSED     [  9%]
models/test_dag.py::TestDag::test_set_jinja_env_additional_option PASSED [ 10%]
models/test_dag.py::TestDag::test_template_undefined PASSED              [ 10%]
models/test_dag.py::TestDag::test_template_env[False-True-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[False-False-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-False-NativeEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-True-SandboxedEnvironment] PASSED [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_value PASSED    [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_list PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cest_to_cet PASSED [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cet_to_cest PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_deprecated_schedule_interval PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_depr_schedule_interval_decorated_dag PASSED [ 15%]
models/test_dag.py::TestDag::test_previous_schedule_datetime_timezone PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone PASSED [ 16%]
models/test_dag.py::TestDag::test_create_dagrun_when_schedule_is_none_and_empty_start_date PASSED [ 16%]
models/test_dag.py::TestDag::test_fail_dag_when_schedule_is_non_none_and_empty_start_date PASSED [ 17%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone_utc0530 PASSED [ 17%]
models/test_dag.py::TestDag::test_dagtag_repr PASSED                     [ 17%]
models/test_dag.py::TestDag::test_bulk_write_to_db PASSED                [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_single_dag PASSED     [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_multiple_dags PASSED  [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[None] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[@daily] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[running] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[queued] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_has_import_error PASSED [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_datasets PASSED       [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_unorphan_datasets PASSED [ 21%]
models/test_dag.py::TestDag::test_sync_to_db PASSED                      [ 22%]
models/test_dag.py::TestDag::test_sync_to_db_default_view PASSED         [ 22%]
models/test_dag.py::TestDag::test_is_paused_subdag PASSED                [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_new_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_config PASSED   [ 24%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_after_limit PASSED [ 24%]
models/test_dag.py::TestDag::test_existing_dag_default_view PASSED       [ 25%]
models/test_dag.py::TestDag::test_dag_is_deactivated_upon_dagfile_deletion PASSED [ 25%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date_with_timezone PASSED [ 25%]
models/test_dag.py::TestDag::test_roots PASSED                           [ 26%]
models/test_dag.py::TestDag::test_leaves PASSED                          [ 26%]
models/test_dag.py::TestDag::test_tree_view PASSED                       [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_with_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_without_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_for_same_task_is_allowed PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_updates_all_references_while_deepcopy PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_taskgroup_join_ids PASSED [ 29%]
models/test_dag.py::TestDag::test_schedule_dag_no_previous_runs PASSED   [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_crash PASSED       [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_with_removed_task PASSED [ 30%]
models/test_dag.py::TestDag::test_next_dagrun_after_fake_scheduled_previous PASSED [ 30%]
models/test_dag.py::TestDag::test_schedule_dag_once PASSED               [ 31%]
models/test_dag.py::TestDag::test_fractional_seconds PASSED              [ 31%]
models/test_dag.py::TestDag::test_pickling PASSED                        [ 31%]
models/test_dag.py::TestDag::test_rich_comparison_ops PASSED             [ 32%]
models/test_dag.py::TestDag::test_get_paused_dag_ids PASSED              [ 32%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[None-expected_timetable0-Never, external triggers only] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@daily-expected_timetable1-At 00:00] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@weekly-expected_timetable2-At 00:00, only on Sunday] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@monthly-expected_timetable3-At 00:00, on day 1 of the month] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@quarterly-expected_timetable4-At 00:00, on day 1 of the month, every 3 months] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@yearly-expected_timetable5-At 00:00, on day 1 of the month, only in January] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[5 0 * 8 *-expected_timetable6-At 00:05, only in August] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@once-expected_timetable7-Once, as soon as possible] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[schedule_interval_arg8-expected_timetable8-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[30 21 * * 5 1-expected_timetable9-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_dataset PASSED [ 37%]
models/test_dag.py::TestDag::test_schedule_interval_still_works PASSED   [ 37%]
models/test_dag.py::TestDag::test_timetable_still_works PASSED           [ 37%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable0-Never, external triggers only] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable1-At 00:00] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable2-At 00:00] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable3-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable4-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable5-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable6-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable7-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable8-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable9-At 00:00, on day 1 of the month, only in January] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable10-At 00:00, on day 1 of the month, only in January] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable11-At 00:05, only in August] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable12-Once, as soon as possible] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable13-] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable14-] PASSED [ 43%]
models/test_dag.py::TestDag::test_create_dagrun_run_id_is_generated PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_run_type_is_obtained_from_run_id PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_job_id_is_set PASSED     [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_checks_trigger_rule PASSED [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_sets_default_task_group PASSED [ 45%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[queued] PASSED  [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[running] PASSED [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[queued] PASSED [ 47%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[running] PASSED [ 47%]
models/test_dag.py::TestDag::test_dag_test_basic PASSED                  [ 47%]
models/test_dag.py::TestDag::test_dag_test_with_dependencies PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_fail_handler PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_task_mapping PASSED      [ 49%]
models/test_dag.py::TestDag::test_dag_connection_file PASSED             [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[queued] PASSED [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[queued] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_dag[None-None] PASSED            [ 51%]
models/test_dag.py::TestDag::test_clear_dag[removed-None] PASSED         [ 51%]
models/test_dag.py::TestDag::test_clear_dag[scheduled-None] PASSED       [ 52%]
models/test_dag.py::TestDag::test_clear_dag[queued-None] PASSED          [ 52%]
models/test_dag.py::TestDag::test_clear_dag[success-None] PASSED         [ 52%]
models/test_dag.py::TestDag::test_clear_dag[restarting-None] PASSED      [ 53%]
models/test_dag.py::TestDag::test_clear_dag[failed-None] PASSED          [ 53%]
models/test_dag.py::TestDag::test_clear_dag[up_for_retry-None] PASSED    [ 54%]
models/test_dag.py::TestDag::test_clear_dag[up_for_reschedule-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[upstream_failed-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[skipped-None] PASSED         [ 55%]
models/test_dag.py::TestDag::test_clear_dag[deferred-None] PASSED        [ 55%]
models/test_dag.py::TestDag::test_clear_dag[shutdown-None] PASSED        [ 56%]
models/test_dag.py::TestDag::test_clear_dag[running-restarting] PASSED   [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_once PASSED           [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_start_end_dates PASSED [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_catchup PASSED        [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[@daily] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule1] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule2] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_true PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_info_timetable_exception PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_after_auto_align PASSED    [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_after_not_for_subdags PASSED [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_info_on_29_feb PASSED      [ 60%]
models/test_dag.py::TestDag::test_replace_outdated_access_control_actions PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field_executor_not_configured PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field PASSED         [ 62%]
models/test_dag.py::TestDag::test_validate_params_on_trigger_dag PASSED  [ 62%]
models/test_dag.py::TestDag::test_return_date_range_with_num_method PASSED [ 62%]
models/test_dag.py::TestDag::test_dag_owner_links PASSED                 [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[schedule_interval+schedule] PASSED [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule] PASSED [ 64%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule_interval] PASSED [ 64%]
models/test_dag.py::TestDag::test_continuous_schedule_interval_linmits_max_active_runs PASSED [ 64%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_not_too_early PASSED [ 65%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_datasets PASSED [ 65%]
models/test_dag.py::TestDagModel::test_max_active_runs_not_none PASSED   [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_only_unpaused PASSED [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_doesnot_send_dagmodel_with_import_errors PASSED [ 66%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/workspace/airflow/tests/dags/a.py-expected_relative0] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/tmp/foo.py-expected_relative1] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/airflow/example_dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/airflow/example_dags] PASSED [ 69%]
models/test_dag.py::TestDagModel::test__processor_dags_folder PASSED     [ 69%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_dataset_triggered_dag_info_queued_times PASSED [ 70%]
models/test_dag.py::TestDagModel::test_dataset_expression PASSED         [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[3] PASSED     [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[12] PASSED    [ 71%]
models/test_dag.py::TestDagDecorator::test_fileloc PASSED                [ 71%]
models/test_dag.py::TestDagDecorator::test_set_dag_id PASSED             [ 72%]
models/test_dag.py::TestDagDecorator::test_default_dag_id PASSED         [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_doc_md] PASSED [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_docstring] PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_documentation_template_rendered PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_fails_if_arg_not_set PASSED   [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_resolves PASSED     [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_dagrun_parameterized PASSED [ 74%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[42] PASSED [ 75%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[0] PASSED  [ 75%]
models/test_dag.py::TestDagDecorator::test_warning_location PASSED       [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable0] PASSED [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable1] PASSED [ 76%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[None] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@once] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@daily] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[schedule_interval3] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[None] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[@daily] PASSED [ 79%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[schedule_interval2] PASSED [ 79%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable0] PASSED [ 80%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable1] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[None-execution_date0] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[test-run-id-None] PASSED [ 81%]
models/test_dag.py::test_set_task_instance_state_mapped PASSED           [ 81%]
models/test_dag.py::test_set_task_group_state[None-execution_date0] PASSED [ 82%]
models/test_dag.py::test_set_task_group_state[test-run-id-None] PASSED   [ 82%]
models/test_dag.py::test_dag_teardowns_property_lists_all_teardown_tasks PASSED [ 82%]
models/test_dag.py::test_iter_dagrun_infos_between[in-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between[out-of-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between_error PASSED          [ 84%]
models/test_dag.py::test_get_next_data_interval[no-next-run] PASSED      [ 84%]
models/test_dag.py::test_get_next_data_interval[modern] PASSED           [ 84%]
models/test_dag.py::test_get_next_data_interval[legacy] PASSED           [ 85%]
models/test_dag.py::test__time_restriction[dag_date0-tasks_date0-restrict0] PASSED [ 85%]
models/test_dag.py::test__time_restriction[dag_date1-tasks_date1-restrict1] PASSED [ 86%]
models/test_dag.py::test__tags_length[empty tags] PASSED                 [ 86%]
models/test_dag.py::test__tags_length[one tag] PASSED                    [ 86%]
models/test_dag.py::test__tags_length[two tags] PASSED                   [ 87%]
models/test_dag.py::test__tags_length[a tag that's of just length 100] PASSED [ 87%]
models/test_dag.py::test__tags_length[two tags and one of them is of length > 100] PASSED [ 88%]
models/test_dag.py::test_get_dataset_triggered_next_run_info PASSED      [ 88%]
models/test_dag.py::test_dag_uses_timetable_for_run_id PASSED            [ 88%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[backfill] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[scheduled] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[dataset_triggered] PASSED [ 90%]
models/test_dag.py::test_invalid_type_for_args PASSED                    [ 90%]
models/test_dag.py::test_dag_init_validates_arg_types PASSED             [ 90%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_ctx_mgr PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_no_ctx_mgr PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_follows_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_one_task_multiple_setup_teardowns PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_and_groups PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clear_upstream_not_your_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_teardown_no_clear_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-False-expected0] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-True-expected1] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-False-expected2] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-True-expected3] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns_deeper PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task2 PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness2 PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_just_teardown PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_validate_setup_teardown_trigger_rule PASSED [ 99%]
models/test_dag.py::test_statement_latest_runs_one_dag PASSED            [ 99%]
models/test_dag.py::test_statement_latest_runs_many_dag PASSED           [100%]
===================== Warning summary. Total: 3, Unique: 2 =====================
airflow: total 2, unique 1
  runtest: total 2, unique 1
other: total 1, unique 1
  runtest: total 1, unique 1
Warnings saved into /workspace/airflow/tests/warnings.txt file.

====================== 251 passed, 1 deselected in 5.79s =======================

2026-01-16 17:06:41,765 - src.tools.run_test - INFO - unit_test.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 1 deselected / 251 selected

models/test_dag.py::TestDag::test_params_not_passed_is_empty_dict PASSED [  0%]
models/test_dag.py::TestDag::test_params_passed_and_params_in_default_args_no_override PASSED [  0%]
models/test_dag.py::TestDag::test_not_none_schedule_with_non_default_params PASSED [  1%]
models/test_dag.py::TestDag::test_dag_invalid_default_view PASSED        [  1%]
models/test_dag.py::TestDag::test_dag_default_view_default_value PASSED  [  1%]
models/test_dag.py::TestDag::test_dag_invalid_orientation PASSED         [  2%]
models/test_dag.py::TestDag::test_dag_orientation_default_value PASSED   [  2%]
models/test_dag.py::TestDag::test_dag_as_context_manager PASSED          [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_include_subdag_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_dag_without_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_naive_start_date_string PASSED     [  4%]
models/test_dag.py::TestDag::test_dag_naive_start_end_dates_strings PASSED [  4%]
models/test_dag.py::TestDag::test_dag_start_date_propagates_to_end_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_none_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total PASSED  [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_upstream PASSED [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_absolute PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_invalid_weight_rule PASSED    [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[StaticTestPriorityWeightStrategy-99] PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[FactorPriorityWeightStrategy-3] PASSED [  8%]
models/test_dag.py::TestDag::test_dag_task_not_registered_weight_strategy PASSED [  8%]
models/test_dag.py::TestDag::test_get_num_task_instances PASSED          [  9%]
models/test_dag.py::TestDag::test_get_task_instances_before PASSED       [  9%]
models/test_dag.py::TestDag::test_user_defined_filters_macros PASSED     [  9%]
models/test_dag.py::TestDag::test_set_jinja_env_additional_option PASSED [ 10%]
models/test_dag.py::TestDag::test_template_undefined PASSED              [ 10%]
models/test_dag.py::TestDag::test_template_env[False-True-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[False-False-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-False-NativeEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-True-SandboxedEnvironment] PASSED [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_value PASSED    [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_list PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cest_to_cet PASSED [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cet_to_cest PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_deprecated_schedule_interval PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_depr_schedule_interval_decorated_dag PASSED [ 15%]
models/test_dag.py::TestDag::test_previous_schedule_datetime_timezone PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone PASSED [ 16%]
models/test_dag.py::TestDag::test_create_dagrun_when_schedule_is_none_and_empty_start_date PASSED [ 16%]
models/test_dag.py::TestDag::test_fail_dag_when_schedule_is_non_none_and_empty_start_date PASSED [ 17%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone_utc0530 PASSED [ 17%]
models/test_dag.py::TestDag::test_dagtag_repr PASSED                     [ 17%]
models/test_dag.py::TestDag::test_bulk_write_to_db PASSED                [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_single_dag PASSED     [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_multiple_dags PASSED  [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[None] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[@daily] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[running] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[queued] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_has_import_error PASSED [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_datasets PASSED       [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_unorphan_datasets PASSED [ 21%]
models/test_dag.py::TestDag::test_sync_to_db PASSED                      [ 22%]
models/test_dag.py::TestDag::test_sync_to_db_default_view PASSED         [ 22%]
models/test_dag.py::TestDag::test_is_paused_subdag PASSED                [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_new_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_config PASSED   [ 24%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_after_limit PASSED [ 24%]
models/test_dag.py::TestDag::test_existing_dag_default_view PASSED       [ 25%]
models/test_dag.py::TestDag::test_dag_is_deactivated_upon_dagfile_deletion PASSED [ 25%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date_with_timezone PASSED [ 25%]
models/test_dag.py::TestDag::test_roots PASSED                           [ 26%]
models/test_dag.py::TestDag::test_leaves PASSED                          [ 26%]
models/test_dag.py::TestDag::test_tree_view PASSED                       [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_with_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_without_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_for_same_task_is_allowed PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_updates_all_references_while_deepcopy PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_taskgroup_join_ids PASSED [ 29%]
models/test_dag.py::TestDag::test_schedule_dag_no_previous_runs PASSED   [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_crash PASSED       [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_with_removed_task PASSED [ 30%]
models/test_dag.py::TestDag::test_next_dagrun_after_fake_scheduled_previous PASSED [ 30%]
models/test_dag.py::TestDag::test_schedule_dag_once PASSED               [ 31%]
models/test_dag.py::TestDag::test_fractional_seconds PASSED              [ 31%]
models/test_dag.py::TestDag::test_pickling PASSED                        [ 31%]
models/test_dag.py::TestDag::test_rich_comparison_ops PASSED             [ 32%]
models/test_dag.py::TestDag::test_get_paused_dag_ids PASSED              [ 32%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[None-expected_timetable0-Never, external triggers only] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@daily-expected_timetable1-At 00:00] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@weekly-expected_timetable2-At 00:00, only on Sunday] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@monthly-expected_timetable3-At 00:00, on day 1 of the month] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@quarterly-expected_timetable4-At 00:00, on day 1 of the month, every 3 months] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@yearly-expected_timetable5-At 00:00, on day 1 of the month, only in January] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[5 0 * 8 *-expected_timetable6-At 00:05, only in August] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@once-expected_timetable7-Once, as soon as possible] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[schedule_interval_arg8-expected_timetable8-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[30 21 * * 5 1-expected_timetable9-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_dataset PASSED [ 37%]
models/test_dag.py::TestDag::test_schedule_interval_still_works PASSED   [ 37%]
models/test_dag.py::TestDag::test_timetable_still_works PASSED           [ 37%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable0-Never, external triggers only] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable1-At 00:00] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable2-At 00:00] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable3-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable4-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable5-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable6-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable7-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable8-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable9-At 00:00, on day 1 of the month, only in January] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable10-At 00:00, on day 1 of the month, only in January] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable11-At 00:05, only in August] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable12-Once, as soon as possible] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable13-] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable14-] PASSED [ 43%]
models/test_dag.py::TestDag::test_create_dagrun_run_id_is_generated PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_run_type_is_obtained_from_run_id PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_job_id_is_set PASSED     [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_checks_trigger_rule PASSED [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_sets_default_task_group PASSED [ 45%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[queued] PASSED  [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[running] PASSED [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[queued] PASSED [ 47%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[running] PASSED [ 47%]
models/test_dag.py::TestDag::test_dag_test_basic PASSED                  [ 47%]
models/test_dag.py::TestDag::test_dag_test_with_dependencies PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_fail_handler PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_task_mapping PASSED      [ 49%]
models/test_dag.py::TestDag::test_dag_connection_file PASSED             [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[queued] PASSED [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[queued] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_dag[None-None] PASSED            [ 51%]
models/test_dag.py::TestDag::test_clear_dag[removed-None] PASSED         [ 51%]
models/test_dag.py::TestDag::test_clear_dag[scheduled-None] PASSED       [ 52%]
models/test_dag.py::TestDag::test_clear_dag[queued-None] PASSED          [ 52%]
models/test_dag.py::TestDag::test_clear_dag[success-None] PASSED         [ 52%]
models/test_dag.py::TestDag::test_clear_dag[restarting-None] PASSED      [ 53%]
models/test_dag.py::TestDag::test_clear_dag[failed-None] PASSED          [ 53%]
models/test_dag.py::TestDag::test_clear_dag[up_for_retry-None] PASSED    [ 54%]
models/test_dag.py::TestDag::test_clear_dag[up_for_reschedule-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[upstream_failed-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[skipped-None] PASSED         [ 55%]
models/test_dag.py::TestDag::test_clear_dag[deferred-None] PASSED        [ 55%]
models/test_dag.py::TestDag::test_clear_dag[shutdown-None] PASSED        [ 56%]
models/test_dag.py::TestDag::test_clear_dag[running-restarting] PASSED   [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_once PASSED           [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_start_end_dates PASSED [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_catchup PASSED        [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[@daily] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule1] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule2] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_true PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_info_timetable_exception PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_after_auto_align PASSED    [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_after_not_for_subdags PASSED [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_info_on_29_feb PASSED      [ 60%]
models/test_dag.py::TestDag::test_replace_outdated_access_control_actions PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field_executor_not_configured PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field PASSED         [ 62%]
models/test_dag.py::TestDag::test_validate_params_on_trigger_dag PASSED  [ 62%]
models/test_dag.py::TestDag::test_return_date_range_with_num_method PASSED [ 62%]
models/test_dag.py::TestDag::test_dag_owner_links PASSED                 [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[schedule_interval+schedule] PASSED [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule] PASSED [ 64%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule_interval] PASSED [ 64%]
models/test_dag.py::TestDag::test_continuous_schedule_interval_linmits_max_active_runs PASSED [ 64%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_not_too_early PASSED [ 65%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_datasets PASSED [ 65%]
models/test_dag.py::TestDagModel::test_max_active_runs_not_none PASSED   [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_only_unpaused PASSED [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_doesnot_send_dagmodel_with_import_errors PASSED [ 66%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/workspace/airflow/tests/dags/a.py-expected_relative0] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/tmp/foo.py-expected_relative1] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/airflow/example_dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/airflow/example_dags] PASSED [ 69%]
models/test_dag.py::TestDagModel::test__processor_dags_folder PASSED     [ 69%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_dataset_triggered_dag_info_queued_times PASSED [ 70%]
models/test_dag.py::TestDagModel::test_dataset_expression PASSED         [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[3] PASSED     [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[12] PASSED    [ 71%]
models/test_dag.py::TestDagDecorator::test_fileloc PASSED                [ 71%]
models/test_dag.py::TestDagDecorator::test_set_dag_id PASSED             [ 72%]
models/test_dag.py::TestDagDecorator::test_default_dag_id PASSED         [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_doc_md] PASSED [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_docstring] PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_documentation_template_rendered PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_fails_if_arg_not_set PASSED   [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_resolves PASSED     [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_dagrun_parameterized PASSED [ 74%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[42] PASSED [ 75%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[0] PASSED  [ 75%]
models/test_dag.py::TestDagDecorator::test_warning_location PASSED       [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable0] PASSED [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable1] PASSED [ 76%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[None] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@once] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@daily] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[schedule_interval3] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[None] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[@daily] PASSED [ 79%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[schedule_interval2] PASSED [ 79%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable0] PASSED [ 80%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable1] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[None-execution_date0] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[test-run-id-None] PASSED [ 81%]
models/test_dag.py::test_set_task_instance_state_mapped PASSED           [ 81%]
models/test_dag.py::test_set_task_group_state[None-execution_date0] PASSED [ 82%]
models/test_dag.py::test_set_task_group_state[test-run-id-None] PASSED   [ 82%]
models/test_dag.py::test_dag_teardowns_property_lists_all_teardown_tasks PASSED [ 82%]
models/test_dag.py::test_iter_dagrun_infos_between[in-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between[out-of-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between_error PASSED          [ 84%]
models/test_dag.py::test_get_next_data_interval[no-next-run] PASSED      [ 84%]
models/test_dag.py::test_get_next_data_interval[modern] PASSED           [ 84%]
models/test_dag.py::test_get_next_data_interval[legacy] PASSED           [ 85%]
models/test_dag.py::test__time_restriction[dag_date0-tasks_date0-restrict0] PASSED [ 85%]
models/test_dag.py::test__time_restriction[dag_date1-tasks_date1-restrict1] PASSED [ 86%]
models/test_dag.py::test__tags_length[empty tags] PASSED                 [ 86%]
models/test_dag.py::test__tags_length[one tag] PASSED                    [ 86%]
models/test_dag.py::test__tags_length[two tags] PASSED                   [ 87%]
models/test_dag.py::test__tags_length[a tag that's of just length 100] PASSED [ 87%]
models/test_dag.py::test__tags_length[two tags and one of them is of length > 100] PASSED [ 88%]
models/test_dag.py::test_get_dataset_triggered_next_run_info PASSED      [ 88%]
models/test_dag.py::test_dag_uses_timetable_for_run_id PASSED            [ 88%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[backfill] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[scheduled] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[dataset_triggered] PASSED [ 90%]
models/test_dag.py::test_invalid_type_for_args PASSED                    [ 90%]
models/test_dag.py::test_dag_init_validates_arg_types PASSED             [ 90%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_ctx_mgr PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_no_ctx_mgr PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_follows_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_one_task_multiple_setup_teardowns PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_and_groups PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clear_upstream_not_your_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_teardown_no_clear_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-False-expected0] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-True-expected1] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-False-expected2] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-True-expected3] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns_deeper PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task2 PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness2 PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_just_teardown PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_validate_setup_teardown_trigger_rule PASSED [ 99%]
models/test_dag.py::test_statement_latest_runs_one_dag PASSED            [ 99%]
models/test_dag.py::test_statement_latest_runs_many_dag PASSED           [100%]
===================== Warning summary. Total: 3, Unique: 2 =====================
airflow: total 2, unique 1
  runtest: total 2, unique 1
other: total 1, unique 1
  runtest: total 1, unique 1
Warnings saved into /workspace/airflow/tests/warnings.txt file.

====================== 251 passed, 1 deselected in 5.79s =======================

2026-01-16 17:06:41,767 - src.agents.base - INFO - Tool RunTest: ✓
2026-01-16 17:06:41,767 - src.agents.base - INFO - Tool RunTest: ✓
2026-01-16 17:06:58,963 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:06:58,963 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:06:58,964 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 771,
  "end_line": 789
}
2026-01-16 17:06:58,964 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 771,
  "end_line": 789
}
2026-01-16 17:06:59,231 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:06:59,231 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:07:02,231 - src.agents.base - INFO - SingleAgent executing tool: EditCode
2026-01-16 17:07:02,231 - src.agents.base - INFO - SingleAgent executing tool: EditCode
2026-01-16 17:07:02,231 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "old_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return f\"\"\"\n                # Templating Error!\n                Not able to find the template file: `{doc_md}`.\n                \"\"\"\n\n        return template.render()",
  "new_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return doc_md\n\n        return template.render()",
  "fuzzy_match": true,
  "skip_validation": false
}
2026-01-16 17:07:02,231 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "old_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return f\"\"\"\n                # Templating Error!\n                Not able to find the template file: `{doc_md}`.\n                \"\"\"\n\n        return template.render()",
  "new_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return doc_md\n\n        return template.render()",
  "fuzzy_match": true,
  "skip_validation": false
}
2026-01-16 17:07:02,409 - src.tools.edit_code - INFO - EditCodeTool: Writing 175792 chars to airflow/models/dag.py (match_type=exact)
2026-01-16 17:07:02,409 - src.tools.edit_code - INFO - EditCodeTool: Writing 175792 chars to airflow/models/dag.py (match_type=exact)
2026-01-16 17:07:02,540 - src.agents.base - INFO - Tool EditCode: ✓
2026-01-16 17:07:02,540 - src.agents.base - INFO - Tool EditCode: ✓
2026-01-16 17:07:03,741 - src.agents.base - INFO - SingleAgent executing tool: RunTest
2026-01-16 17:07:03,741 - src.agents.base - INFO - SingleAgent executing tool: RunTest
2026-01-16 17:07:03,741 - src.agents.base - INFO - Tool arguments:
{
  "run_prepare": true,
  "timeout": 180,
  "include_paths": [
    "airflow/models/dag.py"
  ],
  "run_unittest": true
}
2026-01-16 17:07:03,741 - src.agents.base - INFO - Tool arguments:
{
  "run_prepare": true,
  "timeout": 180,
  "include_paths": [
    "airflow/models/dag.py"
  ],
  "run_unittest": true
}
2026-01-16 17:07:04,074 - src.tools.run_test - INFO - Extracted 1 file paths from /workspace/test.patch: ['tests/models/test_dag.py']
2026-01-16 17:07:04,074 - src.tools.run_test - INFO - Extracted 1 file paths from /workspace/test.patch: ['tests/models/test_dag.py']
2026-01-16 17:07:04,074 - src.tools.run_test - INFO - Generating git diff for fix.patch
2026-01-16 17:07:04,074 - src.tools.run_test - INFO - Generating git diff for fix.patch
2026-01-16 17:07:04,074 - src.tools.run_test - INFO -   include_paths: ['airflow/models/dag.py']
2026-01-16 17:07:04,074 - src.tools.run_test - INFO -   include_paths: ['airflow/models/dag.py']
2026-01-16 17:07:04,074 - src.tools.run_test - INFO -   exclude_paths (from test.patch): ['tests/models/test_dag.py']
2026-01-16 17:07:04,074 - src.tools.run_test - INFO -   exclude_paths (from test.patch): ['tests/models/test_dag.py']
2026-01-16 17:07:04,074 - src.tools.run_test - INFO -   git diff command: git diff HEAD -- 'airflow/models/dag.py' ':(exclude)tests/models/test_dag.py'
2026-01-16 17:07:04,074 - src.tools.run_test - INFO -   git diff command: git diff HEAD -- 'airflow/models/dag.py' ':(exclude)tests/models/test_dag.py'
2026-01-16 17:07:04,227 - src.tools.run_test - INFO -   Generated patch: 752 bytes, 22 lines
2026-01-16 17:07:04,227 - src.tools.run_test - INFO -   Generated patch: 752 bytes, 22 lines
2026-01-16 17:07:04,227 - src.tools.run_test - INFO -   Patch content:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..290796a 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,15 +775,12 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)
             except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
+                return doc_md
 
         return template.render()
 

2026-01-16 17:07:04,227 - src.tools.run_test - INFO -   Patch content:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..290796a 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,15 +775,12 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)
             except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
+                return doc_md
 
         return template.render()
 

2026-01-16 17:07:04,315 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:04,315 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:05,004 - src.tools.run_test - INFO - Running fix-run.sh for PoC validation...
2026-01-16 17:07:05,004 - src.tools.run_test - INFO - Running fix-run.sh for PoC validation...
2026-01-16 17:07:05,095 - src.tools.run_test - INFO - Patch being tested:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..290796a 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,15 +775,12 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)
             except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
+                return doc_md
 
         return template.render()
 


2026-01-16 17:07:05,095 - src.tools.run_test - INFO - Patch being tested:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..290796a 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,15 +775,12 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
             try:
                 template = env.get_template(doc_md)
             except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
+                return doc_md
 
         return template.render()
 


2026-01-16 17:07:07,778 - src.tools.run_test - INFO - fix-run.sh completed with exit code 1
2026-01-16 17:07:07,778 - src.tools.run_test - INFO - fix-run.sh completed with exit code 1
2026-01-16 17:07:07,779 - src.tools.run_test - INFO - fix-run.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 251 deselected / 1 selected

models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered FAILED [100%]

=================================== FAILURES ===================================
____ TestDagDecorator.test_resolve_documentation_template_file_not_rendered ____

self = <tests.models.test_dag.TestDagDecorator object at 0x7ffff3ef4970>
tmp_path = PosixPath('/tmp/pytest-of-root/pytest-1/test_resolve_documentation_tem0')

    def test_resolve_documentation_template_file_not_rendered(self, tmp_path):
        """Test that @dag uses function docs as doc_md for DAG object"""
    
        raw_content = """
        {% if True %}
            External Markdown DAG documentation
        {% endif %}
        """
    
        path = tmp_path / "testfile.md"
        path.write_text(raw_content)
    
        @dag_decorator("test-dag", start_date=DEFAULT_DATE, doc_md=str(path))
        def markdown_docs(): ...
    
        dag = markdown_docs()
        assert isinstance(dag, DAG)
        assert dag.dag_id == "test-dag"
>       assert dag.doc_md == raw_content
E       AssertionError: assert equals failed
E          -'/tmp/pytest-of-root/pytest-1/t   +'\n        {% if True %}\n      
E          -est_resolve_documentation_tem0/   +       External Markdown DAG do 
E          -testfile.md'                      +cumentation\n        {% endif % 
E                                           +}\n        '

models/test_dag.py:3295: AssertionError
---------------------------- Captured stdout setup -----------------------------
========================= AIRFLOW ==========================
Home of the user: /root
Airflow home /root/airflow
Skipping initializing of the DB as it was initialized already.
You can re-initialize the database by adding --with-db-init flag when running tests.
=========================== short test summary info ============================
FAILED models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered - AssertionError: assert equals failed
   -'/tmp/pytest-of-root/pytest-1/t   +'\n        {% if True %}\n      
   -est_resolve_documentation_tem0/   +       External Markdown DAG do 
   -testfile.md'                      +cumentation\n        {% endif % 
                                    +}\n        '
====================== 1 failed, 251 deselected in 1.78s =======================

2026-01-16 17:07:07,779 - src.tools.run_test - INFO - fix-run.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 251 deselected / 1 selected

models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered FAILED [100%]

=================================== FAILURES ===================================
____ TestDagDecorator.test_resolve_documentation_template_file_not_rendered ____

self = <tests.models.test_dag.TestDagDecorator object at 0x7ffff3ef4970>
tmp_path = PosixPath('/tmp/pytest-of-root/pytest-1/test_resolve_documentation_tem0')

    def test_resolve_documentation_template_file_not_rendered(self, tmp_path):
        """Test that @dag uses function docs as doc_md for DAG object"""
    
        raw_content = """
        {% if True %}
            External Markdown DAG documentation
        {% endif %}
        """
    
        path = tmp_path / "testfile.md"
        path.write_text(raw_content)
    
        @dag_decorator("test-dag", start_date=DEFAULT_DATE, doc_md=str(path))
        def markdown_docs(): ...
    
        dag = markdown_docs()
        assert isinstance(dag, DAG)
        assert dag.dag_id == "test-dag"
>       assert dag.doc_md == raw_content
E       AssertionError: assert equals failed
E          -'/tmp/pytest-of-root/pytest-1/t   +'\n        {% if True %}\n      
E          -est_resolve_documentation_tem0/   +       External Markdown DAG do 
E          -testfile.md'                      +cumentation\n        {% endif % 
E                                           +}\n        '

models/test_dag.py:3295: AssertionError
---------------------------- Captured stdout setup -----------------------------
========================= AIRFLOW ==========================
Home of the user: /root
Airflow home /root/airflow
Skipping initializing of the DB as it was initialized already.
You can re-initialize the database by adding --with-db-init flag when running tests.
=========================== short test summary info ============================
FAILED models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered - AssertionError: assert equals failed
   -'/tmp/pytest-of-root/pytest-1/t   +'\n        {% if True %}\n      
   -est_resolve_documentation_tem0/   +       External Markdown DAG do 
   -testfile.md'                      +cumentation\n        {% endif % 
                                    +}\n        '
====================== 1 failed, 251 deselected in 1.78s =======================

2026-01-16 17:07:07,866 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:07,866 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:08,592 - src.tools.run_test - INFO - Running unit_test.sh for regression testing...
2026-01-16 17:07:08,592 - src.tools.run_test - INFO - Running unit_test.sh for regression testing...
2026-01-16 17:07:15,263 - src.tools.run_test - INFO - unit_test.sh completed with exit code 0
2026-01-16 17:07:15,263 - src.tools.run_test - INFO - unit_test.sh completed with exit code 0
2026-01-16 17:07:15,264 - src.tools.run_test - INFO - unit_test.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 1 deselected / 251 selected

models/test_dag.py::TestDag::test_params_not_passed_is_empty_dict PASSED [  0%]
models/test_dag.py::TestDag::test_params_passed_and_params_in_default_args_no_override PASSED [  0%]
models/test_dag.py::TestDag::test_not_none_schedule_with_non_default_params PASSED [  1%]
models/test_dag.py::TestDag::test_dag_invalid_default_view PASSED        [  1%]
models/test_dag.py::TestDag::test_dag_default_view_default_value PASSED  [  1%]
models/test_dag.py::TestDag::test_dag_invalid_orientation PASSED         [  2%]
models/test_dag.py::TestDag::test_dag_orientation_default_value PASSED   [  2%]
models/test_dag.py::TestDag::test_dag_as_context_manager PASSED          [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_include_subdag_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_dag_without_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_naive_start_date_string PASSED     [  4%]
models/test_dag.py::TestDag::test_dag_naive_start_end_dates_strings PASSED [  4%]
models/test_dag.py::TestDag::test_dag_start_date_propagates_to_end_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_none_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total PASSED  [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_upstream PASSED [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_absolute PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_invalid_weight_rule PASSED    [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[StaticTestPriorityWeightStrategy-99] PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[FactorPriorityWeightStrategy-3] PASSED [  8%]
models/test_dag.py::TestDag::test_dag_task_not_registered_weight_strategy PASSED [  8%]
models/test_dag.py::TestDag::test_get_num_task_instances PASSED          [  9%]
models/test_dag.py::TestDag::test_get_task_instances_before PASSED       [  9%]
models/test_dag.py::TestDag::test_user_defined_filters_macros PASSED     [  9%]
models/test_dag.py::TestDag::test_set_jinja_env_additional_option PASSED [ 10%]
models/test_dag.py::TestDag::test_template_undefined PASSED              [ 10%]
models/test_dag.py::TestDag::test_template_env[False-True-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[False-False-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-False-NativeEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-True-SandboxedEnvironment] PASSED [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_value PASSED    [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_list PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cest_to_cet PASSED [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cet_to_cest PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_deprecated_schedule_interval PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_depr_schedule_interval_decorated_dag PASSED [ 15%]
models/test_dag.py::TestDag::test_previous_schedule_datetime_timezone PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone PASSED [ 16%]
models/test_dag.py::TestDag::test_create_dagrun_when_schedule_is_none_and_empty_start_date PASSED [ 16%]
models/test_dag.py::TestDag::test_fail_dag_when_schedule_is_non_none_and_empty_start_date PASSED [ 17%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone_utc0530 PASSED [ 17%]
models/test_dag.py::TestDag::test_dagtag_repr PASSED                     [ 17%]
models/test_dag.py::TestDag::test_bulk_write_to_db PASSED                [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_single_dag PASSED     [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_multiple_dags PASSED  [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[None] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[@daily] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[running] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[queued] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_has_import_error PASSED [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_datasets PASSED       [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_unorphan_datasets PASSED [ 21%]
models/test_dag.py::TestDag::test_sync_to_db PASSED                      [ 22%]
models/test_dag.py::TestDag::test_sync_to_db_default_view PASSED         [ 22%]
models/test_dag.py::TestDag::test_is_paused_subdag PASSED                [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_new_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_config PASSED   [ 24%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_after_limit PASSED [ 24%]
models/test_dag.py::TestDag::test_existing_dag_default_view PASSED       [ 25%]
models/test_dag.py::TestDag::test_dag_is_deactivated_upon_dagfile_deletion PASSED [ 25%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date_with_timezone PASSED [ 25%]
models/test_dag.py::TestDag::test_roots PASSED                           [ 26%]
models/test_dag.py::TestDag::test_leaves PASSED                          [ 26%]
models/test_dag.py::TestDag::test_tree_view PASSED                       [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_with_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_without_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_for_same_task_is_allowed PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_updates_all_references_while_deepcopy PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_taskgroup_join_ids PASSED [ 29%]
models/test_dag.py::TestDag::test_schedule_dag_no_previous_runs PASSED   [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_crash PASSED       [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_with_removed_task PASSED [ 30%]
models/test_dag.py::TestDag::test_next_dagrun_after_fake_scheduled_previous PASSED [ 30%]
models/test_dag.py::TestDag::test_schedule_dag_once PASSED               [ 31%]
models/test_dag.py::TestDag::test_fractional_seconds PASSED              [ 31%]
models/test_dag.py::TestDag::test_pickling PASSED                        [ 31%]
models/test_dag.py::TestDag::test_rich_comparison_ops PASSED             [ 32%]
models/test_dag.py::TestDag::test_get_paused_dag_ids PASSED              [ 32%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[None-expected_timetable0-Never, external triggers only] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@daily-expected_timetable1-At 00:00] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@weekly-expected_timetable2-At 00:00, only on Sunday] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@monthly-expected_timetable3-At 00:00, on day 1 of the month] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@quarterly-expected_timetable4-At 00:00, on day 1 of the month, every 3 months] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@yearly-expected_timetable5-At 00:00, on day 1 of the month, only in January] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[5 0 * 8 *-expected_timetable6-At 00:05, only in August] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@once-expected_timetable7-Once, as soon as possible] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[schedule_interval_arg8-expected_timetable8-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[30 21 * * 5 1-expected_timetable9-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_dataset PASSED [ 37%]
models/test_dag.py::TestDag::test_schedule_interval_still_works PASSED   [ 37%]
models/test_dag.py::TestDag::test_timetable_still_works PASSED           [ 37%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable0-Never, external triggers only] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable1-At 00:00] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable2-At 00:00] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable3-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable4-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable5-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable6-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable7-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable8-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable9-At 00:00, on day 1 of the month, only in January] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable10-At 00:00, on day 1 of the month, only in January] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable11-At 00:05, only in August] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable12-Once, as soon as possible] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable13-] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable14-] PASSED [ 43%]
models/test_dag.py::TestDag::test_create_dagrun_run_id_is_generated PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_run_type_is_obtained_from_run_id PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_job_id_is_set PASSED     [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_checks_trigger_rule PASSED [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_sets_default_task_group PASSED [ 45%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[queued] PASSED  [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[running] PASSED [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[queued] PASSED [ 47%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[running] PASSED [ 47%]
models/test_dag.py::TestDag::test_dag_test_basic PASSED                  [ 47%]
models/test_dag.py::TestDag::test_dag_test_with_dependencies PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_fail_handler PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_task_mapping PASSED      [ 49%]
models/test_dag.py::TestDag::test_dag_connection_file PASSED             [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[queued] PASSED [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[queued] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_dag[None-None] PASSED            [ 51%]
models/test_dag.py::TestDag::test_clear_dag[removed-None] PASSED         [ 51%]
models/test_dag.py::TestDag::test_clear_dag[scheduled-None] PASSED       [ 52%]
models/test_dag.py::TestDag::test_clear_dag[queued-None] PASSED          [ 52%]
models/test_dag.py::TestDag::test_clear_dag[success-None] PASSED         [ 52%]
models/test_dag.py::TestDag::test_clear_dag[restarting-None] PASSED      [ 53%]
models/test_dag.py::TestDag::test_clear_dag[failed-None] PASSED          [ 53%]
models/test_dag.py::TestDag::test_clear_dag[up_for_retry-None] PASSED    [ 54%]
models/test_dag.py::TestDag::test_clear_dag[up_for_reschedule-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[upstream_failed-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[skipped-None] PASSED         [ 55%]
models/test_dag.py::TestDag::test_clear_dag[deferred-None] PASSED        [ 55%]
models/test_dag.py::TestDag::test_clear_dag[shutdown-None] PASSED        [ 56%]
models/test_dag.py::TestDag::test_clear_dag[running-restarting] PASSED   [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_once PASSED           [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_start_end_dates PASSED [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_catchup PASSED        [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[@daily] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule1] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule2] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_true PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_info_timetable_exception PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_after_auto_align PASSED    [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_after_not_for_subdags PASSED [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_info_on_29_feb PASSED      [ 60%]
models/test_dag.py::TestDag::test_replace_outdated_access_control_actions PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field_executor_not_configured PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field PASSED         [ 62%]
models/test_dag.py::TestDag::test_validate_params_on_trigger_dag PASSED  [ 62%]
models/test_dag.py::TestDag::test_return_date_range_with_num_method PASSED [ 62%]
models/test_dag.py::TestDag::test_dag_owner_links PASSED                 [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[schedule_interval+schedule] PASSED [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule] PASSED [ 64%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule_interval] PASSED [ 64%]
models/test_dag.py::TestDag::test_continuous_schedule_interval_linmits_max_active_runs PASSED [ 64%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_not_too_early PASSED [ 65%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_datasets PASSED [ 65%]
models/test_dag.py::TestDagModel::test_max_active_runs_not_none PASSED   [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_only_unpaused PASSED [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_doesnot_send_dagmodel_with_import_errors PASSED [ 66%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/workspace/airflow/tests/dags/a.py-expected_relative0] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/tmp/foo.py-expected_relative1] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/airflow/example_dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/airflow/example_dags] PASSED [ 69%]
models/test_dag.py::TestDagModel::test__processor_dags_folder PASSED     [ 69%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_dataset_triggered_dag_info_queued_times PASSED [ 70%]
models/test_dag.py::TestDagModel::test_dataset_expression PASSED         [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[3] PASSED     [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[12] PASSED    [ 71%]
models/test_dag.py::TestDagDecorator::test_fileloc PASSED                [ 71%]
models/test_dag.py::TestDagDecorator::test_set_dag_id PASSED             [ 72%]
models/test_dag.py::TestDagDecorator::test_default_dag_id PASSED         [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_doc_md] PASSED [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_docstring] PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_documentation_template_rendered PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_fails_if_arg_not_set PASSED   [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_resolves PASSED     [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_dagrun_parameterized PASSED [ 74%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[42] PASSED [ 75%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[0] PASSED  [ 75%]
models/test_dag.py::TestDagDecorator::test_warning_location PASSED       [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable0] PASSED [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable1] PASSED [ 76%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[None] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@once] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@daily] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[schedule_interval3] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[None] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[@daily] PASSED [ 79%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[schedule_interval2] PASSED [ 79%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable0] PASSED [ 80%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable1] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[None-execution_date0] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[test-run-id-None] PASSED [ 81%]
models/test_dag.py::test_set_task_instance_state_mapped PASSED           [ 81%]
models/test_dag.py::test_set_task_group_state[None-execution_date0] PASSED [ 82%]
models/test_dag.py::test_set_task_group_state[test-run-id-None] PASSED   [ 82%]
models/test_dag.py::test_dag_teardowns_property_lists_all_teardown_tasks PASSED [ 82%]
models/test_dag.py::test_iter_dagrun_infos_between[in-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between[out-of-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between_error PASSED          [ 84%]
models/test_dag.py::test_get_next_data_interval[no-next-run] PASSED      [ 84%]
models/test_dag.py::test_get_next_data_interval[modern] PASSED           [ 84%]
models/test_dag.py::test_get_next_data_interval[legacy] PASSED           [ 85%]
models/test_dag.py::test__time_restriction[dag_date0-tasks_date0-restrict0] PASSED [ 85%]
models/test_dag.py::test__time_restriction[dag_date1-tasks_date1-restrict1] PASSED [ 86%]
models/test_dag.py::test__tags_length[empty tags] PASSED                 [ 86%]
models/test_dag.py::test__tags_length[one tag] PASSED                    [ 86%]
models/test_dag.py::test__tags_length[two tags] PASSED                   [ 87%]
models/test_dag.py::test__tags_length[a tag that's of just length 100] PASSED [ 87%]
models/test_dag.py::test__tags_length[two tags and one of them is of length > 100] PASSED [ 88%]
models/test_dag.py::test_get_dataset_triggered_next_run_info PASSED      [ 88%]
models/test_dag.py::test_dag_uses_timetable_for_run_id PASSED            [ 88%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[backfill] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[scheduled] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[dataset_triggered] PASSED [ 90%]
models/test_dag.py::test_invalid_type_for_args PASSED                    [ 90%]
models/test_dag.py::test_dag_init_validates_arg_types PASSED             [ 90%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_ctx_mgr PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_no_ctx_mgr PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_follows_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_one_task_multiple_setup_teardowns PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_and_groups PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clear_upstream_not_your_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_teardown_no_clear_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-False-expected0] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-True-expected1] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-False-expected2] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-True-expected3] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns_deeper PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task2 PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness2 PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_just_teardown PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_validate_setup_teardown_trigger_rule PASSED [ 99%]
models/test_dag.py::test_statement_latest_runs_one_dag PASSED            [ 99%]
models/test_dag.py::test_statement_latest_runs_many_dag PASSED           [100%]
===================== Warning summary. Total: 3, Unique: 2 =====================
airflow: total 2, unique 1
  runtest: total 2, unique 1
other: total 1, unique 1
  runtest: total 1, unique 1
Warnings saved into /workspace/airflow/tests/warnings.txt file.

====================== 251 passed, 1 deselected in 5.67s =======================

2026-01-16 17:07:15,264 - src.tools.run_test - INFO - unit_test.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 1 deselected / 251 selected

models/test_dag.py::TestDag::test_params_not_passed_is_empty_dict PASSED [  0%]
models/test_dag.py::TestDag::test_params_passed_and_params_in_default_args_no_override PASSED [  0%]
models/test_dag.py::TestDag::test_not_none_schedule_with_non_default_params PASSED [  1%]
models/test_dag.py::TestDag::test_dag_invalid_default_view PASSED        [  1%]
models/test_dag.py::TestDag::test_dag_default_view_default_value PASSED  [  1%]
models/test_dag.py::TestDag::test_dag_invalid_orientation PASSED         [  2%]
models/test_dag.py::TestDag::test_dag_orientation_default_value PASSED   [  2%]
models/test_dag.py::TestDag::test_dag_as_context_manager PASSED          [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_include_subdag_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_dag_without_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_naive_start_date_string PASSED     [  4%]
models/test_dag.py::TestDag::test_dag_naive_start_end_dates_strings PASSED [  4%]
models/test_dag.py::TestDag::test_dag_start_date_propagates_to_end_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_none_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total PASSED  [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_upstream PASSED [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_absolute PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_invalid_weight_rule PASSED    [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[StaticTestPriorityWeightStrategy-99] PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[FactorPriorityWeightStrategy-3] PASSED [  8%]
models/test_dag.py::TestDag::test_dag_task_not_registered_weight_strategy PASSED [  8%]
models/test_dag.py::TestDag::test_get_num_task_instances PASSED          [  9%]
models/test_dag.py::TestDag::test_get_task_instances_before PASSED       [  9%]
models/test_dag.py::TestDag::test_user_defined_filters_macros PASSED     [  9%]
models/test_dag.py::TestDag::test_set_jinja_env_additional_option PASSED [ 10%]
models/test_dag.py::TestDag::test_template_undefined PASSED              [ 10%]
models/test_dag.py::TestDag::test_template_env[False-True-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[False-False-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-False-NativeEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-True-SandboxedEnvironment] PASSED [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_value PASSED    [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_list PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cest_to_cet PASSED [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cet_to_cest PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_deprecated_schedule_interval PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_depr_schedule_interval_decorated_dag PASSED [ 15%]
models/test_dag.py::TestDag::test_previous_schedule_datetime_timezone PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone PASSED [ 16%]
models/test_dag.py::TestDag::test_create_dagrun_when_schedule_is_none_and_empty_start_date PASSED [ 16%]
models/test_dag.py::TestDag::test_fail_dag_when_schedule_is_non_none_and_empty_start_date PASSED [ 17%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone_utc0530 PASSED [ 17%]
models/test_dag.py::TestDag::test_dagtag_repr PASSED                     [ 17%]
models/test_dag.py::TestDag::test_bulk_write_to_db PASSED                [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_single_dag PASSED     [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_multiple_dags PASSED  [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[None] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[@daily] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[running] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[queued] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_has_import_error PASSED [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_datasets PASSED       [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_unorphan_datasets PASSED [ 21%]
models/test_dag.py::TestDag::test_sync_to_db PASSED                      [ 22%]
models/test_dag.py::TestDag::test_sync_to_db_default_view PASSED         [ 22%]
models/test_dag.py::TestDag::test_is_paused_subdag PASSED                [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_new_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_config PASSED   [ 24%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_after_limit PASSED [ 24%]
models/test_dag.py::TestDag::test_existing_dag_default_view PASSED       [ 25%]
models/test_dag.py::TestDag::test_dag_is_deactivated_upon_dagfile_deletion PASSED [ 25%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date_with_timezone PASSED [ 25%]
models/test_dag.py::TestDag::test_roots PASSED                           [ 26%]
models/test_dag.py::TestDag::test_leaves PASSED                          [ 26%]
models/test_dag.py::TestDag::test_tree_view PASSED                       [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_with_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_without_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_for_same_task_is_allowed PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_updates_all_references_while_deepcopy PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_taskgroup_join_ids PASSED [ 29%]
models/test_dag.py::TestDag::test_schedule_dag_no_previous_runs PASSED   [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_crash PASSED       [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_with_removed_task PASSED [ 30%]
models/test_dag.py::TestDag::test_next_dagrun_after_fake_scheduled_previous PASSED [ 30%]
models/test_dag.py::TestDag::test_schedule_dag_once PASSED               [ 31%]
models/test_dag.py::TestDag::test_fractional_seconds PASSED              [ 31%]
models/test_dag.py::TestDag::test_pickling PASSED                        [ 31%]
models/test_dag.py::TestDag::test_rich_comparison_ops PASSED             [ 32%]
models/test_dag.py::TestDag::test_get_paused_dag_ids PASSED              [ 32%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[None-expected_timetable0-Never, external triggers only] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@daily-expected_timetable1-At 00:00] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@weekly-expected_timetable2-At 00:00, only on Sunday] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@monthly-expected_timetable3-At 00:00, on day 1 of the month] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@quarterly-expected_timetable4-At 00:00, on day 1 of the month, every 3 months] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@yearly-expected_timetable5-At 00:00, on day 1 of the month, only in January] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[5 0 * 8 *-expected_timetable6-At 00:05, only in August] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@once-expected_timetable7-Once, as soon as possible] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[schedule_interval_arg8-expected_timetable8-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[30 21 * * 5 1-expected_timetable9-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_dataset PASSED [ 37%]
models/test_dag.py::TestDag::test_schedule_interval_still_works PASSED   [ 37%]
models/test_dag.py::TestDag::test_timetable_still_works PASSED           [ 37%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable0-Never, external triggers only] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable1-At 00:00] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable2-At 00:00] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable3-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable4-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable5-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable6-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable7-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable8-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable9-At 00:00, on day 1 of the month, only in January] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable10-At 00:00, on day 1 of the month, only in January] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable11-At 00:05, only in August] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable12-Once, as soon as possible] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable13-] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable14-] PASSED [ 43%]
models/test_dag.py::TestDag::test_create_dagrun_run_id_is_generated PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_run_type_is_obtained_from_run_id PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_job_id_is_set PASSED     [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_checks_trigger_rule PASSED [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_sets_default_task_group PASSED [ 45%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[queued] PASSED  [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[running] PASSED [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[queued] PASSED [ 47%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[running] PASSED [ 47%]
models/test_dag.py::TestDag::test_dag_test_basic PASSED                  [ 47%]
models/test_dag.py::TestDag::test_dag_test_with_dependencies PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_fail_handler PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_task_mapping PASSED      [ 49%]
models/test_dag.py::TestDag::test_dag_connection_file PASSED             [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[queued] PASSED [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[queued] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_dag[None-None] PASSED            [ 51%]
models/test_dag.py::TestDag::test_clear_dag[removed-None] PASSED         [ 51%]
models/test_dag.py::TestDag::test_clear_dag[scheduled-None] PASSED       [ 52%]
models/test_dag.py::TestDag::test_clear_dag[queued-None] PASSED          [ 52%]
models/test_dag.py::TestDag::test_clear_dag[success-None] PASSED         [ 52%]
models/test_dag.py::TestDag::test_clear_dag[restarting-None] PASSED      [ 53%]
models/test_dag.py::TestDag::test_clear_dag[failed-None] PASSED          [ 53%]
models/test_dag.py::TestDag::test_clear_dag[up_for_retry-None] PASSED    [ 54%]
models/test_dag.py::TestDag::test_clear_dag[up_for_reschedule-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[upstream_failed-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[skipped-None] PASSED         [ 55%]
models/test_dag.py::TestDag::test_clear_dag[deferred-None] PASSED        [ 55%]
models/test_dag.py::TestDag::test_clear_dag[shutdown-None] PASSED        [ 56%]
models/test_dag.py::TestDag::test_clear_dag[running-restarting] PASSED   [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_once PASSED           [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_start_end_dates PASSED [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_catchup PASSED        [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[@daily] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule1] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule2] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_true PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_info_timetable_exception PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_after_auto_align PASSED    [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_after_not_for_subdags PASSED [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_info_on_29_feb PASSED      [ 60%]
models/test_dag.py::TestDag::test_replace_outdated_access_control_actions PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field_executor_not_configured PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field PASSED         [ 62%]
models/test_dag.py::TestDag::test_validate_params_on_trigger_dag PASSED  [ 62%]
models/test_dag.py::TestDag::test_return_date_range_with_num_method PASSED [ 62%]
models/test_dag.py::TestDag::test_dag_owner_links PASSED                 [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[schedule_interval+schedule] PASSED [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule] PASSED [ 64%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule_interval] PASSED [ 64%]
models/test_dag.py::TestDag::test_continuous_schedule_interval_linmits_max_active_runs PASSED [ 64%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_not_too_early PASSED [ 65%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_datasets PASSED [ 65%]
models/test_dag.py::TestDagModel::test_max_active_runs_not_none PASSED   [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_only_unpaused PASSED [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_doesnot_send_dagmodel_with_import_errors PASSED [ 66%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/workspace/airflow/tests/dags/a.py-expected_relative0] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/tmp/foo.py-expected_relative1] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/airflow/example_dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/airflow/example_dags] PASSED [ 69%]
models/test_dag.py::TestDagModel::test__processor_dags_folder PASSED     [ 69%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_dataset_triggered_dag_info_queued_times PASSED [ 70%]
models/test_dag.py::TestDagModel::test_dataset_expression PASSED         [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[3] PASSED     [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[12] PASSED    [ 71%]
models/test_dag.py::TestDagDecorator::test_fileloc PASSED                [ 71%]
models/test_dag.py::TestDagDecorator::test_set_dag_id PASSED             [ 72%]
models/test_dag.py::TestDagDecorator::test_default_dag_id PASSED         [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_doc_md] PASSED [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_docstring] PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_documentation_template_rendered PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_fails_if_arg_not_set PASSED   [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_resolves PASSED     [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_dagrun_parameterized PASSED [ 74%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[42] PASSED [ 75%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[0] PASSED  [ 75%]
models/test_dag.py::TestDagDecorator::test_warning_location PASSED       [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable0] PASSED [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable1] PASSED [ 76%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[None] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@once] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@daily] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[schedule_interval3] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[None] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[@daily] PASSED [ 79%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[schedule_interval2] PASSED [ 79%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable0] PASSED [ 80%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable1] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[None-execution_date0] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[test-run-id-None] PASSED [ 81%]
models/test_dag.py::test_set_task_instance_state_mapped PASSED           [ 81%]
models/test_dag.py::test_set_task_group_state[None-execution_date0] PASSED [ 82%]
models/test_dag.py::test_set_task_group_state[test-run-id-None] PASSED   [ 82%]
models/test_dag.py::test_dag_teardowns_property_lists_all_teardown_tasks PASSED [ 82%]
models/test_dag.py::test_iter_dagrun_infos_between[in-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between[out-of-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between_error PASSED          [ 84%]
models/test_dag.py::test_get_next_data_interval[no-next-run] PASSED      [ 84%]
models/test_dag.py::test_get_next_data_interval[modern] PASSED           [ 84%]
models/test_dag.py::test_get_next_data_interval[legacy] PASSED           [ 85%]
models/test_dag.py::test__time_restriction[dag_date0-tasks_date0-restrict0] PASSED [ 85%]
models/test_dag.py::test__time_restriction[dag_date1-tasks_date1-restrict1] PASSED [ 86%]
models/test_dag.py::test__tags_length[empty tags] PASSED                 [ 86%]
models/test_dag.py::test__tags_length[one tag] PASSED                    [ 86%]
models/test_dag.py::test__tags_length[two tags] PASSED                   [ 87%]
models/test_dag.py::test__tags_length[a tag that's of just length 100] PASSED [ 87%]
models/test_dag.py::test__tags_length[two tags and one of them is of length > 100] PASSED [ 88%]
models/test_dag.py::test_get_dataset_triggered_next_run_info PASSED      [ 88%]
models/test_dag.py::test_dag_uses_timetable_for_run_id PASSED            [ 88%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[backfill] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[scheduled] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[dataset_triggered] PASSED [ 90%]
models/test_dag.py::test_invalid_type_for_args PASSED                    [ 90%]
models/test_dag.py::test_dag_init_validates_arg_types PASSED             [ 90%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_ctx_mgr PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_no_ctx_mgr PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_follows_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_one_task_multiple_setup_teardowns PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_and_groups PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clear_upstream_not_your_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_teardown_no_clear_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-False-expected0] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-True-expected1] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-False-expected2] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-True-expected3] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns_deeper PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task2 PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness2 PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_just_teardown PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_validate_setup_teardown_trigger_rule PASSED [ 99%]
models/test_dag.py::test_statement_latest_runs_one_dag PASSED            [ 99%]
models/test_dag.py::test_statement_latest_runs_many_dag PASSED           [100%]
===================== Warning summary. Total: 3, Unique: 2 =====================
airflow: total 2, unique 1
  runtest: total 2, unique 1
other: total 1, unique 1
  runtest: total 1, unique 1
Warnings saved into /workspace/airflow/tests/warnings.txt file.

====================== 251 passed, 1 deselected in 5.67s =======================

2026-01-16 17:07:15,266 - src.agents.base - INFO - Tool RunTest: ✓
2026-01-16 17:07:15,266 - src.agents.base - INFO - Tool RunTest: ✓
2026-01-16 17:07:23,399 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:07:23,399 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:07:23,400 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 1,
  "end_line": 20
}
2026-01-16 17:07:23,400 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 1,
  "end_line": 20
}
2026-01-16 17:07:23,585 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:07:23,585 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:07:25,405 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:07:25,405 - src.agents.base - INFO - SingleAgent executing tool: ReadFile
2026-01-16 17:07:25,405 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 21,
  "end_line": 40
}
2026-01-16 17:07:25,405 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "start_line": 21,
  "end_line": 40
}
2026-01-16 17:07:25,567 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:07:25,567 - src.agents.base - INFO - Tool ReadFile: ✓
2026-01-16 17:07:30,605 - src.agents.base - INFO - SingleAgent executing tool: EditCode
2026-01-16 17:07:30,605 - src.agents.base - INFO - SingleAgent executing tool: EditCode
2026-01-16 17:07:30,605 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "old_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return doc_md\n\n        return template.render()",
  "new_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            # Try to treat doc_md as a file path and return its content if possible\n            try:\n                with open(doc_md, 'r', encoding='utf-8') as f:\n                    return f.read()\n            except (OSError, TypeError, ValueError):\n                # If not a file, try to load as a template\n                try:\n                    template = env.get_template(doc_md)\n                except jinja2.exceptions.TemplateNotFound:\n                    return doc_md\n                return template.render()\n        return template.render()",
  "fuzzy_match": true,
  "skip_validation": false
}
2026-01-16 17:07:30,605 - src.agents.base - INFO - Tool arguments:
{
  "file_path": "airflow/models/dag.py",
  "old_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            try:\n                template = env.get_template(doc_md)\n            except jinja2.exceptions.TemplateNotFound:\n                return doc_md\n\n        return template.render()",
  "new_code": "        if not doc_md.endswith(\".md\"):\n            template = env.from_string(doc_md)\n        else:\n            # Try to treat doc_md as a file path and return its content if possible\n            try:\n                with open(doc_md, 'r', encoding='utf-8') as f:\n                    return f.read()\n            except (OSError, TypeError, ValueError):\n                # If not a file, try to load as a template\n                try:\n                    template = env.get_template(doc_md)\n                except jinja2.exceptions.TemplateNotFound:\n                    return doc_md\n                return template.render()\n        return template.render()",
  "fuzzy_match": true,
  "skip_validation": false
}
2026-01-16 17:07:30,794 - src.tools.edit_code - INFO - EditCodeTool: Writing 176160 chars to airflow/models/dag.py (match_type=exact)
2026-01-16 17:07:30,794 - src.tools.edit_code - INFO - EditCodeTool: Writing 176160 chars to airflow/models/dag.py (match_type=exact)
2026-01-16 17:07:30,935 - src.agents.base - INFO - Tool EditCode: ✓
2026-01-16 17:07:30,935 - src.agents.base - INFO - Tool EditCode: ✓
2026-01-16 17:07:32,068 - src.agents.base - INFO - SingleAgent executing tool: RunTest
2026-01-16 17:07:32,068 - src.agents.base - INFO - SingleAgent executing tool: RunTest
2026-01-16 17:07:32,068 - src.agents.base - INFO - Tool arguments:
{
  "run_prepare": true,
  "timeout": 180,
  "include_paths": [
    "airflow/models/dag.py"
  ],
  "run_unittest": true
}
2026-01-16 17:07:32,068 - src.agents.base - INFO - Tool arguments:
{
  "run_prepare": true,
  "timeout": 180,
  "include_paths": [
    "airflow/models/dag.py"
  ],
  "run_unittest": true
}
2026-01-16 17:07:32,399 - src.tools.run_test - INFO - Extracted 1 file paths from /workspace/test.patch: ['tests/models/test_dag.py']
2026-01-16 17:07:32,399 - src.tools.run_test - INFO - Extracted 1 file paths from /workspace/test.patch: ['tests/models/test_dag.py']
2026-01-16 17:07:32,400 - src.tools.run_test - INFO - Generating git diff for fix.patch
2026-01-16 17:07:32,400 - src.tools.run_test - INFO - Generating git diff for fix.patch
2026-01-16 17:07:32,400 - src.tools.run_test - INFO -   include_paths: ['airflow/models/dag.py']
2026-01-16 17:07:32,400 - src.tools.run_test - INFO -   include_paths: ['airflow/models/dag.py']
2026-01-16 17:07:32,400 - src.tools.run_test - INFO -   exclude_paths (from test.patch): ['tests/models/test_dag.py']
2026-01-16 17:07:32,400 - src.tools.run_test - INFO -   exclude_paths (from test.patch): ['tests/models/test_dag.py']
2026-01-16 17:07:32,400 - src.tools.run_test - INFO -   git diff command: git diff HEAD -- 'airflow/models/dag.py' ':(exclude)tests/models/test_dag.py'
2026-01-16 17:07:32,400 - src.tools.run_test - INFO -   git diff command: git diff HEAD -- 'airflow/models/dag.py' ':(exclude)tests/models/test_dag.py'
2026-01-16 17:07:32,548 - src.tools.run_test - INFO -   Generated patch: 1304 bytes, 32 lines
2026-01-16 17:07:32,548 - src.tools.run_test - INFO -   Generated patch: 1304 bytes, 32 lines
2026-01-16 17:07:32,549 - src.tools.run_test - INFO -   Patch content:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..a08f2c7 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,16 +775,19 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
+            # Try to treat doc_md as a file path and return its content if possible
             try:
-                template = env.get_template(doc_md)
-            except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
-
+                with open(doc_md, 'r', encoding='utf-8') as f:
+                    return f.read()
+            except (OSError, TypeError, ValueError):
+                # If not a file, try to load as a template
+                try:
+                    template = env.get_template(doc_md)
+                except jinja2.exceptions.TemplateNotFound:
+                    return doc_md
+                return template.render()
         return template.render()
 
     def _check_schedule_interval_matches_timetable(self) -> bool:

2026-01-16 17:07:32,549 - src.tools.run_test - INFO -   Patch content:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..a08f2c7 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,16 +775,19 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
+            # Try to treat doc_md as a file path and return its content if possible
             try:
-                template = env.get_template(doc_md)
-            except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
-
+                with open(doc_md, 'r', encoding='utf-8') as f:
+                    return f.read()
+            except (OSError, TypeError, ValueError):
+                # If not a file, try to load as a template
+                try:
+                    template = env.get_template(doc_md)
+                except jinja2.exceptions.TemplateNotFound:
+                    return doc_md
+                return template.render()
         return template.render()
 
     def _check_schedule_interval_matches_timetable(self) -> bool:

2026-01-16 17:07:32,635 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:32,635 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:33,301 - src.tools.run_test - INFO - Running fix-run.sh for PoC validation...
2026-01-16 17:07:33,301 - src.tools.run_test - INFO - Running fix-run.sh for PoC validation...
2026-01-16 17:07:33,394 - src.tools.run_test - INFO - Patch being tested:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..a08f2c7 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,16 +775,19 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
+            # Try to treat doc_md as a file path and return its content if possible
             try:
-                template = env.get_template(doc_md)
-            except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
-
+                with open(doc_md, 'r', encoding='utf-8') as f:
+                    return f.read()
+            except (OSError, TypeError, ValueError):
+                # If not a file, try to load as a template
+                try:
+                    template = env.get_template(doc_md)
+                except jinja2.exceptions.TemplateNotFound:
+                    return doc_md
+                return template.render()
         return template.render()
 
     def _check_schedule_interval_matches_timetable(self) -> bool:


2026-01-16 17:07:33,394 - src.tools.run_test - INFO - Patch being tested:
diff --git a/airflow/models/dag.py b/airflow/models/dag.py
index 560d05b..a08f2c7 100644
--- a/airflow/models/dag.py
+++ b/airflow/models/dag.py
@@ -775,16 +775,19 @@ class DAG(LoggingMixin):
         env = self.get_template_env(force_sandboxed=True)
 
         if not doc_md.endswith(".md"):
-            template = jinja2.Template(doc_md)
+            template = env.from_string(doc_md)
         else:
+            # Try to treat doc_md as a file path and return its content if possible
             try:
-                template = env.get_template(doc_md)
-            except jinja2.exceptions.TemplateNotFound:
-                return f"""
-                # Templating Error!
-                Not able to find the template file: `{doc_md}`.
-                """
-
+                with open(doc_md, 'r', encoding='utf-8') as f:
+                    return f.read()
+            except (OSError, TypeError, ValueError):
+                # If not a file, try to load as a template
+                try:
+                    template = env.get_template(doc_md)
+                except jinja2.exceptions.TemplateNotFound:
+                    return doc_md
+                return template.render()
         return template.render()
 
     def _check_schedule_interval_matches_timetable(self) -> bool:


2026-01-16 17:07:35,778 - src.tools.run_test - INFO - fix-run.sh completed with exit code 0
2026-01-16 17:07:35,778 - src.tools.run_test - INFO - fix-run.sh completed with exit code 0
2026-01-16 17:07:35,779 - src.tools.run_test - INFO - fix-run.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 251 deselected / 1 selected

models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered PASSED [100%]

====================== 1 passed, 251 deselected in 1.49s =======================

2026-01-16 17:07:35,779 - src.tools.run_test - INFO - fix-run.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 251 deselected / 1 selected

models/test_dag.py::TestDagDecorator::test_resolve_documentation_template_file_not_rendered PASSED [100%]

====================== 1 passed, 251 deselected in 1.49s =======================

2026-01-16 17:07:35,892 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:35,892 - src.tools.run_test - INFO - Running prepare.sh to reset repository...
2026-01-16 17:07:36,679 - src.tools.run_test - INFO - Running unit_test.sh for regression testing...
2026-01-16 17:07:36,679 - src.tools.run_test - INFO - Running unit_test.sh for regression testing...
2026-01-16 17:07:43,349 - src.tools.run_test - INFO - unit_test.sh completed with exit code 0
2026-01-16 17:07:43,349 - src.tools.run_test - INFO - unit_test.sh completed with exit code 0
2026-01-16 17:07:43,350 - src.tools.run_test - INFO - unit_test.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 1 deselected / 251 selected

models/test_dag.py::TestDag::test_params_not_passed_is_empty_dict PASSED [  0%]
models/test_dag.py::TestDag::test_params_passed_and_params_in_default_args_no_override PASSED [  0%]
models/test_dag.py::TestDag::test_not_none_schedule_with_non_default_params PASSED [  1%]
models/test_dag.py::TestDag::test_dag_invalid_default_view PASSED        [  1%]
models/test_dag.py::TestDag::test_dag_default_view_default_value PASSED  [  1%]
models/test_dag.py::TestDag::test_dag_invalid_orientation PASSED         [  2%]
models/test_dag.py::TestDag::test_dag_orientation_default_value PASSED   [  2%]
models/test_dag.py::TestDag::test_dag_as_context_manager PASSED          [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_include_subdag_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_dag_without_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_naive_start_date_string PASSED     [  4%]
models/test_dag.py::TestDag::test_dag_naive_start_end_dates_strings PASSED [  4%]
models/test_dag.py::TestDag::test_dag_start_date_propagates_to_end_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_none_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total PASSED  [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_upstream PASSED [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_absolute PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_invalid_weight_rule PASSED    [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[StaticTestPriorityWeightStrategy-99] PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[FactorPriorityWeightStrategy-3] PASSED [  8%]
models/test_dag.py::TestDag::test_dag_task_not_registered_weight_strategy PASSED [  8%]
models/test_dag.py::TestDag::test_get_num_task_instances PASSED          [  9%]
models/test_dag.py::TestDag::test_get_task_instances_before PASSED       [  9%]
models/test_dag.py::TestDag::test_user_defined_filters_macros PASSED     [  9%]
models/test_dag.py::TestDag::test_set_jinja_env_additional_option PASSED [ 10%]
models/test_dag.py::TestDag::test_template_undefined PASSED              [ 10%]
models/test_dag.py::TestDag::test_template_env[False-True-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[False-False-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-False-NativeEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-True-SandboxedEnvironment] PASSED [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_value PASSED    [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_list PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cest_to_cet PASSED [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cet_to_cest PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_deprecated_schedule_interval PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_depr_schedule_interval_decorated_dag PASSED [ 15%]
models/test_dag.py::TestDag::test_previous_schedule_datetime_timezone PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone PASSED [ 16%]
models/test_dag.py::TestDag::test_create_dagrun_when_schedule_is_none_and_empty_start_date PASSED [ 16%]
models/test_dag.py::TestDag::test_fail_dag_when_schedule_is_non_none_and_empty_start_date PASSED [ 17%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone_utc0530 PASSED [ 17%]
models/test_dag.py::TestDag::test_dagtag_repr PASSED                     [ 17%]
models/test_dag.py::TestDag::test_bulk_write_to_db PASSED                [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_single_dag PASSED     [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_multiple_dags PASSED  [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[None] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[@daily] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[running] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[queued] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_has_import_error PASSED [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_datasets PASSED       [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_unorphan_datasets PASSED [ 21%]
models/test_dag.py::TestDag::test_sync_to_db PASSED                      [ 22%]
models/test_dag.py::TestDag::test_sync_to_db_default_view PASSED         [ 22%]
models/test_dag.py::TestDag::test_is_paused_subdag PASSED                [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_new_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_config PASSED   [ 24%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_after_limit PASSED [ 24%]
models/test_dag.py::TestDag::test_existing_dag_default_view PASSED       [ 25%]
models/test_dag.py::TestDag::test_dag_is_deactivated_upon_dagfile_deletion PASSED [ 25%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date_with_timezone PASSED [ 25%]
models/test_dag.py::TestDag::test_roots PASSED                           [ 26%]
models/test_dag.py::TestDag::test_leaves PASSED                          [ 26%]
models/test_dag.py::TestDag::test_tree_view PASSED                       [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_with_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_without_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_for_same_task_is_allowed PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_updates_all_references_while_deepcopy PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_taskgroup_join_ids PASSED [ 29%]
models/test_dag.py::TestDag::test_schedule_dag_no_previous_runs PASSED   [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_crash PASSED       [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_with_removed_task PASSED [ 30%]
models/test_dag.py::TestDag::test_next_dagrun_after_fake_scheduled_previous PASSED [ 30%]
models/test_dag.py::TestDag::test_schedule_dag_once PASSED               [ 31%]
models/test_dag.py::TestDag::test_fractional_seconds PASSED              [ 31%]
models/test_dag.py::TestDag::test_pickling PASSED                        [ 31%]
models/test_dag.py::TestDag::test_rich_comparison_ops PASSED             [ 32%]
models/test_dag.py::TestDag::test_get_paused_dag_ids PASSED              [ 32%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[None-expected_timetable0-Never, external triggers only] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@daily-expected_timetable1-At 00:00] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@weekly-expected_timetable2-At 00:00, only on Sunday] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@monthly-expected_timetable3-At 00:00, on day 1 of the month] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@quarterly-expected_timetable4-At 00:00, on day 1 of the month, every 3 months] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@yearly-expected_timetable5-At 00:00, on day 1 of the month, only in January] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[5 0 * 8 *-expected_timetable6-At 00:05, only in August] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@once-expected_timetable7-Once, as soon as possible] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[schedule_interval_arg8-expected_timetable8-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[30 21 * * 5 1-expected_timetable9-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_dataset PASSED [ 37%]
models/test_dag.py::TestDag::test_schedule_interval_still_works PASSED   [ 37%]
models/test_dag.py::TestDag::test_timetable_still_works PASSED           [ 37%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable0-Never, external triggers only] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable1-At 00:00] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable2-At 00:00] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable3-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable4-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable5-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable6-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable7-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable8-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable9-At 00:00, on day 1 of the month, only in January] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable10-At 00:00, on day 1 of the month, only in January] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable11-At 00:05, only in August] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable12-Once, as soon as possible] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable13-] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable14-] PASSED [ 43%]
models/test_dag.py::TestDag::test_create_dagrun_run_id_is_generated PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_run_type_is_obtained_from_run_id PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_job_id_is_set PASSED     [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_checks_trigger_rule PASSED [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_sets_default_task_group PASSED [ 45%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[queued] PASSED  [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[running] PASSED [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[queued] PASSED [ 47%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[running] PASSED [ 47%]
models/test_dag.py::TestDag::test_dag_test_basic PASSED                  [ 47%]
models/test_dag.py::TestDag::test_dag_test_with_dependencies PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_fail_handler PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_task_mapping PASSED      [ 49%]
models/test_dag.py::TestDag::test_dag_connection_file PASSED             [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[queued] PASSED [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[queued] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_dag[None-None] PASSED            [ 51%]
models/test_dag.py::TestDag::test_clear_dag[removed-None] PASSED         [ 51%]
models/test_dag.py::TestDag::test_clear_dag[scheduled-None] PASSED       [ 52%]
models/test_dag.py::TestDag::test_clear_dag[queued-None] PASSED          [ 52%]
models/test_dag.py::TestDag::test_clear_dag[success-None] PASSED         [ 52%]
models/test_dag.py::TestDag::test_clear_dag[restarting-None] PASSED      [ 53%]
models/test_dag.py::TestDag::test_clear_dag[failed-None] PASSED          [ 53%]
models/test_dag.py::TestDag::test_clear_dag[up_for_retry-None] PASSED    [ 54%]
models/test_dag.py::TestDag::test_clear_dag[up_for_reschedule-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[upstream_failed-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[skipped-None] PASSED         [ 55%]
models/test_dag.py::TestDag::test_clear_dag[deferred-None] PASSED        [ 55%]
models/test_dag.py::TestDag::test_clear_dag[shutdown-None] PASSED        [ 56%]
models/test_dag.py::TestDag::test_clear_dag[running-restarting] PASSED   [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_once PASSED           [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_start_end_dates PASSED [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_catchup PASSED        [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[@daily] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule1] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule2] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_true PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_info_timetable_exception PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_after_auto_align PASSED    [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_after_not_for_subdags PASSED [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_info_on_29_feb PASSED      [ 60%]
models/test_dag.py::TestDag::test_replace_outdated_access_control_actions PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field_executor_not_configured PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field PASSED         [ 62%]
models/test_dag.py::TestDag::test_validate_params_on_trigger_dag PASSED  [ 62%]
models/test_dag.py::TestDag::test_return_date_range_with_num_method PASSED [ 62%]
models/test_dag.py::TestDag::test_dag_owner_links PASSED                 [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[schedule_interval+schedule] PASSED [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule] PASSED [ 64%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule_interval] PASSED [ 64%]
models/test_dag.py::TestDag::test_continuous_schedule_interval_linmits_max_active_runs PASSED [ 64%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_not_too_early PASSED [ 65%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_datasets PASSED [ 65%]
models/test_dag.py::TestDagModel::test_max_active_runs_not_none PASSED   [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_only_unpaused PASSED [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_doesnot_send_dagmodel_with_import_errors PASSED [ 66%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/workspace/airflow/tests/dags/a.py-expected_relative0] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/tmp/foo.py-expected_relative1] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/airflow/example_dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/airflow/example_dags] PASSED [ 69%]
models/test_dag.py::TestDagModel::test__processor_dags_folder PASSED     [ 69%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_dataset_triggered_dag_info_queued_times PASSED [ 70%]
models/test_dag.py::TestDagModel::test_dataset_expression PASSED         [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[3] PASSED     [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[12] PASSED    [ 71%]
models/test_dag.py::TestDagDecorator::test_fileloc PASSED                [ 71%]
models/test_dag.py::TestDagDecorator::test_set_dag_id PASSED             [ 72%]
models/test_dag.py::TestDagDecorator::test_default_dag_id PASSED         [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_doc_md] PASSED [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_docstring] PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_documentation_template_rendered PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_fails_if_arg_not_set PASSED   [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_resolves PASSED     [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_dagrun_parameterized PASSED [ 74%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[42] PASSED [ 75%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[0] PASSED  [ 75%]
models/test_dag.py::TestDagDecorator::test_warning_location PASSED       [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable0] PASSED [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable1] PASSED [ 76%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[None] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@once] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@daily] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[schedule_interval3] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[None] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[@daily] PASSED [ 79%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[schedule_interval2] PASSED [ 79%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable0] PASSED [ 80%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable1] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[None-execution_date0] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[test-run-id-None] PASSED [ 81%]
models/test_dag.py::test_set_task_instance_state_mapped PASSED           [ 81%]
models/test_dag.py::test_set_task_group_state[None-execution_date0] PASSED [ 82%]
models/test_dag.py::test_set_task_group_state[test-run-id-None] PASSED   [ 82%]
models/test_dag.py::test_dag_teardowns_property_lists_all_teardown_tasks PASSED [ 82%]
models/test_dag.py::test_iter_dagrun_infos_between[in-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between[out-of-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between_error PASSED          [ 84%]
models/test_dag.py::test_get_next_data_interval[no-next-run] PASSED      [ 84%]
models/test_dag.py::test_get_next_data_interval[modern] PASSED           [ 84%]
models/test_dag.py::test_get_next_data_interval[legacy] PASSED           [ 85%]
models/test_dag.py::test__time_restriction[dag_date0-tasks_date0-restrict0] PASSED [ 85%]
models/test_dag.py::test__time_restriction[dag_date1-tasks_date1-restrict1] PASSED [ 86%]
models/test_dag.py::test__tags_length[empty tags] PASSED                 [ 86%]
models/test_dag.py::test__tags_length[one tag] PASSED                    [ 86%]
models/test_dag.py::test__tags_length[two tags] PASSED                   [ 87%]
models/test_dag.py::test__tags_length[a tag that's of just length 100] PASSED [ 87%]
models/test_dag.py::test__tags_length[two tags and one of them is of length > 100] PASSED [ 88%]
models/test_dag.py::test_get_dataset_triggered_next_run_info PASSED      [ 88%]
models/test_dag.py::test_dag_uses_timetable_for_run_id PASSED            [ 88%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[backfill] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[scheduled] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[dataset_triggered] PASSED [ 90%]
models/test_dag.py::test_invalid_type_for_args PASSED                    [ 90%]
models/test_dag.py::test_dag_init_validates_arg_types PASSED             [ 90%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_ctx_mgr PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_no_ctx_mgr PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_follows_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_one_task_multiple_setup_teardowns PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_and_groups PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clear_upstream_not_your_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_teardown_no_clear_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-False-expected0] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-True-expected1] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-False-expected2] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-True-expected3] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns_deeper PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task2 PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness2 PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_just_teardown PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_validate_setup_teardown_trigger_rule PASSED [ 99%]
models/test_dag.py::test_statement_latest_runs_one_dag PASSED            [ 99%]
models/test_dag.py::test_statement_latest_runs_many_dag PASSED           [100%]
===================== Warning summary. Total: 3, Unique: 2 =====================
airflow: total 2, unique 1
  runtest: total 2, unique 1
other: total 1, unique 1
  runtest: total 1, unique 1
Warnings saved into /workspace/airflow/tests/warnings.txt file.

====================== 251 passed, 1 deselected in 5.69s =======================

2026-01-16 17:07:43,350 - src.tools.run_test - INFO - unit_test.sh output:
/workspace/PoC_env/CVE-2024-39877/lib/python3.10/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.10.16, pytest-8.3.5, pluggy-1.5.0 -- /workspace/PoC_env/CVE-2024-39877/bin/python
cachedir: .pytest_cache
rootdir: /workspace/airflow
configfile: pyproject.toml
plugins: mock-3.14.0, xdist-3.6.1, cov-6.1.1, icdiff-0.9, anyio-4.9.0, timeouts-1.2.1, rerunfailures-15.0, custom-exit-code-0.3.0, requests-mock-1.12.1, asyncio-0.26.0, instafail-0.5.0, time-machine-2.16.0
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
setup timeout: 0.0s, execution timeout: 0.0s, teardown timeout: 0.0s
collecting ... collected 252 items / 1 deselected / 251 selected

models/test_dag.py::TestDag::test_params_not_passed_is_empty_dict PASSED [  0%]
models/test_dag.py::TestDag::test_params_passed_and_params_in_default_args_no_override PASSED [  0%]
models/test_dag.py::TestDag::test_not_none_schedule_with_non_default_params PASSED [  1%]
models/test_dag.py::TestDag::test_dag_invalid_default_view PASSED        [  1%]
models/test_dag.py::TestDag::test_dag_default_view_default_value PASSED  [  1%]
models/test_dag.py::TestDag::test_dag_invalid_orientation PASSED         [  2%]
models/test_dag.py::TestDag::test_dag_orientation_default_value PASSED   [  2%]
models/test_dag.py::TestDag::test_dag_as_context_manager PASSED          [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_include_subdag_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_topological_sort_dag_without_tasks PASSED [  3%]
models/test_dag.py::TestDag::test_dag_naive_start_date_string PASSED     [  4%]
models/test_dag.py::TestDag::test_dag_naive_start_end_dates_strings PASSED [  4%]
models/test_dag.py::TestDag::test_dag_start_date_propagates_to_end_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_none_default_args_start_date PASSED [  5%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total PASSED  [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_upstream PASSED [  6%]
models/test_dag.py::TestDag::test_dag_task_priority_weight_total_using_absolute PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_invalid_weight_rule PASSED    [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[StaticTestPriorityWeightStrategy-99] PASSED [  7%]
models/test_dag.py::TestDag::test_dag_task_custom_weight_strategy[FactorPriorityWeightStrategy-3] PASSED [  8%]
models/test_dag.py::TestDag::test_dag_task_not_registered_weight_strategy PASSED [  8%]
models/test_dag.py::TestDag::test_get_num_task_instances PASSED          [  9%]
models/test_dag.py::TestDag::test_get_task_instances_before PASSED       [  9%]
models/test_dag.py::TestDag::test_user_defined_filters_macros PASSED     [  9%]
models/test_dag.py::TestDag::test_set_jinja_env_additional_option PASSED [ 10%]
models/test_dag.py::TestDag::test_template_undefined PASSED              [ 10%]
models/test_dag.py::TestDag::test_template_env[False-True-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[False-False-SandboxedEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-False-NativeEnvironment] PASSED [ 11%]
models/test_dag.py::TestDag::test_template_env[True-True-SandboxedEnvironment] PASSED [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_value PASSED    [ 12%]
models/test_dag.py::TestDag::test_resolve_template_files_list PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule PASSED     [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cest_to_cet PASSED [ 13%]
models/test_dag.py::TestDag::test_following_previous_schedule_daily_dag_cet_to_cest PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta PASSED [ 14%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_deprecated_schedule_interval PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_relativedelta_with_depr_schedule_interval_decorated_dag PASSED [ 15%]
models/test_dag.py::TestDag::test_previous_schedule_datetime_timezone PASSED [ 15%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone PASSED [ 16%]
models/test_dag.py::TestDag::test_create_dagrun_when_schedule_is_none_and_empty_start_date PASSED [ 16%]
models/test_dag.py::TestDag::test_fail_dag_when_schedule_is_non_none_and_empty_start_date PASSED [ 17%]
models/test_dag.py::TestDag::test_following_schedule_datetime_timezone_utc0530 PASSED [ 17%]
models/test_dag.py::TestDag::test_dagtag_repr PASSED                     [ 17%]
models/test_dag.py::TestDag::test_bulk_write_to_db PASSED                [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_single_dag PASSED     [ 18%]
models/test_dag.py::TestDag::test_bulk_write_to_db_multiple_dags PASSED  [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[None] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_interval_save_runtime[@daily] PASSED [ 19%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[running] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_max_active_runs[queued] PASSED [ 20%]
models/test_dag.py::TestDag::test_bulk_write_to_db_has_import_error PASSED [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_datasets PASSED       [ 21%]
models/test_dag.py::TestDag::test_bulk_write_to_db_unorphan_datasets PASSED [ 21%]
models/test_dag.py::TestDag::test_sync_to_db PASSED                      [ 22%]
models/test_dag.py::TestDag::test_sync_to_db_default_view PASSED         [ 22%]
models/test_dag.py::TestDag::test_is_paused_subdag PASSED                [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_new_dag_is_paused_upon_creation PASSED [ 23%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_config PASSED   [ 24%]
models/test_dag.py::TestDag::test_existing_dag_is_paused_after_limit PASSED [ 24%]
models/test_dag.py::TestDag::test_existing_dag_default_view PASSED       [ 25%]
models/test_dag.py::TestDag::test_dag_is_deactivated_upon_dagfile_deletion PASSED [ 25%]
models/test_dag.py::TestDag::test_dag_naive_default_args_start_date_with_timezone PASSED [ 25%]
models/test_dag.py::TestDag::test_roots PASSED                           [ 26%]
models/test_dag.py::TestDag::test_leaves PASSED                          [ 26%]
models/test_dag.py::TestDag::test_tree_view PASSED                       [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_with_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_not_allowed_without_dag_context_manager PASSED [ 27%]
models/test_dag.py::TestDag::test_duplicate_task_ids_for_same_task_is_allowed PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_updates_all_references_while_deepcopy PASSED [ 28%]
models/test_dag.py::TestDag::test_partial_subset_taskgroup_join_ids PASSED [ 29%]
models/test_dag.py::TestDag::test_schedule_dag_no_previous_runs PASSED   [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_crash PASSED       [ 29%]
models/test_dag.py::TestDag::test_dag_handle_callback_with_removed_task PASSED [ 30%]
models/test_dag.py::TestDag::test_next_dagrun_after_fake_scheduled_previous PASSED [ 30%]
models/test_dag.py::TestDag::test_schedule_dag_once PASSED               [ 31%]
models/test_dag.py::TestDag::test_fractional_seconds PASSED              [ 31%]
models/test_dag.py::TestDag::test_pickling PASSED                        [ 31%]
models/test_dag.py::TestDag::test_rich_comparison_ops PASSED             [ 32%]
models/test_dag.py::TestDag::test_get_paused_dag_ids PASSED              [ 32%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[None-expected_timetable0-Never, external triggers only] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@daily-expected_timetable1-At 00:00] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@weekly-expected_timetable2-At 00:00, only on Sunday] PASSED [ 33%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@monthly-expected_timetable3-At 00:00, on day 1 of the month] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@quarterly-expected_timetable4-At 00:00, on day 1 of the month, every 3 months] PASSED [ 34%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@yearly-expected_timetable5-At 00:00, on day 1 of the month, only in January] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[5 0 * 8 *-expected_timetable6-At 00:05, only in August] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[@once-expected_timetable7-Once, as soon as possible] PASSED [ 35%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[schedule_interval_arg8-expected_timetable8-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_schedule_interval_arg[30 21 * * 5 1-expected_timetable9-] PASSED [ 36%]
models/test_dag.py::TestDag::test_timetable_and_description_from_dataset PASSED [ 37%]
models/test_dag.py::TestDag::test_schedule_interval_still_works PASSED   [ 37%]
models/test_dag.py::TestDag::test_timetable_still_works PASSED           [ 37%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable0-Never, external triggers only] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable1-At 00:00] PASSED [ 38%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable2-At 00:00] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable3-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable4-At 00:00, only on Sunday] PASSED [ 39%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable5-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable6-At 00:00, on day 1 of the month] PASSED [ 40%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable7-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable8-At 00:00, on day 1 of the month, every 3 months] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable9-At 00:00, on day 1 of the month, only in January] PASSED [ 41%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable10-At 00:00, on day 1 of the month, only in January] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable11-At 00:05, only in August] PASSED [ 42%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable12-Once, as soon as possible] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable13-] PASSED [ 43%]
models/test_dag.py::TestDag::test_description_from_timetable[timetable14-] PASSED [ 43%]
models/test_dag.py::TestDag::test_create_dagrun_run_id_is_generated PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_run_type_is_obtained_from_run_id PASSED [ 44%]
models/test_dag.py::TestDag::test_create_dagrun_job_id_is_set PASSED     [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_checks_trigger_rule PASSED [ 45%]
models/test_dag.py::TestDag::test_dag_add_task_sets_default_task_group PASSED [ 45%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[queued] PASSED  [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state[running] PASSED [ 46%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[queued] PASSED [ 47%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_mapped_task[running] PASSED [ 47%]
models/test_dag.py::TestDag::test_dag_test_basic PASSED                  [ 47%]
models/test_dag.py::TestDag::test_dag_test_with_dependencies PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_fail_handler PASSED      [ 48%]
models/test_dag.py::TestDag::test_dag_test_with_task_mapping PASSED      [ 49%]
models/test_dag.py::TestDag::test_dag_connection_file PASSED             [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[queued] PASSED [ 49%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_subdag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[queued] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_set_dagrun_state_for_parent_dag[running] PASSED [ 50%]
models/test_dag.py::TestDag::test_clear_dag[None-None] PASSED            [ 51%]
models/test_dag.py::TestDag::test_clear_dag[removed-None] PASSED         [ 51%]
models/test_dag.py::TestDag::test_clear_dag[scheduled-None] PASSED       [ 52%]
models/test_dag.py::TestDag::test_clear_dag[queued-None] PASSED          [ 52%]
models/test_dag.py::TestDag::test_clear_dag[success-None] PASSED         [ 52%]
models/test_dag.py::TestDag::test_clear_dag[restarting-None] PASSED      [ 53%]
models/test_dag.py::TestDag::test_clear_dag[failed-None] PASSED          [ 53%]
models/test_dag.py::TestDag::test_clear_dag[up_for_retry-None] PASSED    [ 54%]
models/test_dag.py::TestDag::test_clear_dag[up_for_reschedule-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[upstream_failed-None] PASSED [ 54%]
models/test_dag.py::TestDag::test_clear_dag[skipped-None] PASSED         [ 55%]
models/test_dag.py::TestDag::test_clear_dag[deferred-None] PASSED        [ 55%]
models/test_dag.py::TestDag::test_clear_dag[shutdown-None] PASSED        [ 56%]
models/test_dag.py::TestDag::test_clear_dag[running-restarting] PASSED   [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_once PASSED           [ 56%]
models/test_dag.py::TestDag::test_next_dagrun_info_start_end_dates PASSED [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_catchup PASSED        [ 57%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[@daily] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule1] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_false[schedule2] PASSED [ 58%]
models/test_dag.py::TestDag::test_next_dagrun_info_timedelta_schedule_and_catchup_true PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_info_timetable_exception PASSED [ 59%]
models/test_dag.py::TestDag::test_next_dagrun_after_auto_align PASSED    [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_after_not_for_subdags PASSED [ 60%]
models/test_dag.py::TestDag::test_next_dagrun_info_on_29_feb PASSED      [ 60%]
models/test_dag.py::TestDag::test_replace_outdated_access_control_actions PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field_executor_not_configured PASSED [ 61%]
models/test_dag.py::TestDag::test_validate_executor_field PASSED         [ 62%]
models/test_dag.py::TestDag::test_validate_params_on_trigger_dag PASSED  [ 62%]
models/test_dag.py::TestDag::test_return_date_range_with_num_method PASSED [ 62%]
models/test_dag.py::TestDag::test_dag_owner_links PASSED                 [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[schedule_interval+schedule] PASSED [ 63%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule] PASSED [ 64%]
models/test_dag.py::TestDag::test_schedule_dag_param[timetable+schedule_interval] PASSED [ 64%]
models/test_dag.py::TestDag::test_continuous_schedule_interval_linmits_max_active_runs PASSED [ 64%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_not_too_early PASSED [ 65%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_datasets PASSED [ 65%]
models/test_dag.py::TestDagModel::test_max_active_runs_not_none PASSED   [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_only_unpaused PASSED [ 66%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_doesnot_send_dagmodel_with_import_errors PASSED [ 66%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/workspace/airflow/tests/dags/a.py-expected_relative0] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc[/tmp/foo.py-expected_relative1] PASSED [ 67%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/workspace/airflow/tests/dags/a.py-expected_relative0-/workspace/airflow/airflow/example_dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/tests/dags] PASSED [ 68%]
models/test_dag.py::TestDagModel::test_relative_fileloc_serialized[/tmp/foo.py-expected_relative1-/workspace/airflow/airflow/example_dags] PASSED [ 69%]
models/test_dag.py::TestDagModel::test__processor_dags_folder PASSED     [ 69%]
models/test_dag.py::TestDagModel::test_dags_needing_dagruns_dataset_triggered_dag_info_queued_times PASSED [ 70%]
models/test_dag.py::TestDagModel::test_dataset_expression PASSED         [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[3] PASSED     [ 70%]
models/test_dag.py::TestQueries::test_count_number_queries[12] PASSED    [ 71%]
models/test_dag.py::TestDagDecorator::test_fileloc PASSED                [ 71%]
models/test_dag.py::TestDagDecorator::test_set_dag_id PASSED             [ 72%]
models/test_dag.py::TestDagDecorator::test_default_dag_id PASSED         [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_doc_md] PASSED [ 72%]
models/test_dag.py::TestDagDecorator::test_documentation_added[use_dag_docstring] PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_documentation_template_rendered PASSED [ 73%]
models/test_dag.py::TestDagDecorator::test_fails_if_arg_not_set PASSED   [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_resolves PASSED     [ 74%]
models/test_dag.py::TestDagDecorator::test_dag_param_dagrun_parameterized PASSED [ 74%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[42] PASSED [ 75%]
models/test_dag.py::TestDagDecorator::test_set_params_for_dag[0] PASSED  [ 75%]
models/test_dag.py::TestDagDecorator::test_warning_location PASSED       [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable0] PASSED [ 76%]
models/test_dag.py::test_dag_timetable_match_schedule_interval[timetable1] PASSED [ 76%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[None] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@once] PASSED [ 77%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[@daily] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_match_timetable[schedule_interval3] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[None] PASSED [ 78%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[@daily] PASSED [ 79%]
models/test_dag.py::test_dag_schedule_interval_change_after_init[schedule_interval2] PASSED [ 79%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable0] PASSED [ 80%]
models/test_dag.py::test_dag_timetable_change_after_init[timetable1] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[None-execution_date0] PASSED [ 80%]
models/test_dag.py::test_set_task_instance_state[test-run-id-None] PASSED [ 81%]
models/test_dag.py::test_set_task_instance_state_mapped PASSED           [ 81%]
models/test_dag.py::test_set_task_group_state[None-execution_date0] PASSED [ 82%]
models/test_dag.py::test_set_task_group_state[test-run-id-None] PASSED   [ 82%]
models/test_dag.py::test_dag_teardowns_property_lists_all_teardown_tasks PASSED [ 82%]
models/test_dag.py::test_iter_dagrun_infos_between[in-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between[out-of-dag-restriction] PASSED [ 83%]
models/test_dag.py::test_iter_dagrun_infos_between_error PASSED          [ 84%]
models/test_dag.py::test_get_next_data_interval[no-next-run] PASSED      [ 84%]
models/test_dag.py::test_get_next_data_interval[modern] PASSED           [ 84%]
models/test_dag.py::test_get_next_data_interval[legacy] PASSED           [ 85%]
models/test_dag.py::test__time_restriction[dag_date0-tasks_date0-restrict0] PASSED [ 85%]
models/test_dag.py::test__time_restriction[dag_date1-tasks_date1-restrict1] PASSED [ 86%]
models/test_dag.py::test__tags_length[empty tags] PASSED                 [ 86%]
models/test_dag.py::test__tags_length[one tag] PASSED                    [ 86%]
models/test_dag.py::test__tags_length[two tags] PASSED                   [ 87%]
models/test_dag.py::test__tags_length[a tag that's of just length 100] PASSED [ 87%]
models/test_dag.py::test__tags_length[two tags and one of them is of length > 100] PASSED [ 88%]
models/test_dag.py::test_get_dataset_triggered_next_run_info PASSED      [ 88%]
models/test_dag.py::test_dag_uses_timetable_for_run_id PASSED            [ 88%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[backfill] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[scheduled] PASSED [ 89%]
models/test_dag.py::test_create_dagrun_disallow_manual_to_use_automated_run_id[dataset_triggered] PASSED [ 90%]
models/test_dag.py::test_invalid_type_for_args PASSED                    [ 90%]
models/test_dag.py::test_dag_init_validates_arg_types PASSED             [ 90%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_ctx_mgr PASSED [ 91%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_nested_no_ctx_mgr PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_follows_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns PASSED [ 92%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_one_task_multiple_setup_teardowns PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_with_setup_and_groups PASSED [ 93%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clear_upstream_not_your_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_teardown_no_clear_setup PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown PASSED [ 94%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-False-expected0] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[False-True-expected1] PASSED [ 95%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-False-expected2] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_setup_clears_teardown_taskflow[True-True-expected3] PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_get_flat_relative_ids_two_tasks_diff_setup_teardowns_deeper PASSED [ 96%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_multiple_setups_for_work_task2 PASSED [ 97%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_more_tertiary_weirdness2 PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_clearing_behavior_just_teardown PASSED [ 98%]
models/test_dag.py::TestTaskClearingSetupTeardownBehavior::test_validate_setup_teardown_trigger_rule PASSED [ 99%]
models/test_dag.py::test_statement_latest_runs_one_dag PASSED            [ 99%]
models/test_dag.py::test_statement_latest_runs_many_dag PASSED           [100%]
===================== Warning summary. Total: 3, Unique: 2 =====================
airflow: total 2, unique 1
  runtest: total 2, unique 1
other: total 1, unique 1
  runtest: total 1, unique 1
Warnings saved into /workspace/airflow/tests/warnings.txt file.

====================== 251 passed, 1 deselected in 5.69s =======================

2026-01-16 17:07:43,352 - src.agents.base - INFO - Tool RunTest: ✓
2026-01-16 17:07:43,352 - src.agents.base - INFO - Tool RunTest: ✓
2026-01-16 17:07:49,240 - src.agents.base - INFO - SingleAgent - LLM response (943 chars):
```json
{
  "status": "success",
  "vulnerability": "Arbitrary code execution via unsandboxed Jinja2 template rendering in DAG.get_doc_md (CWE-94, CWE-77, CWE-78).",
  "fix": "All template rendering is now performed in a sandboxed environment. For .md files, the file content is returned directly if possible, otherwise templates are rendered securely using the sandboxed environment.",
  "iterations": 3,
  "files_modified": ["airflow/models/dag.py"],
  "verification": {
    "poc_passed": true,
    "regression_passed": true
  }
}
```
**Summary:**  
- The vulnerability was due to using `jinja2.Template(doc_md)` (unsandboxed) for string templates, allowing code execution.
- The fix ensures all template rendering uses the sandboxed environment (`env.from_string`), and for `.md` files, the file content is returned directly if possible, matching expected behavior.
- All PoC and regression tests now pass. The patch is complete and secure.
2026-01-16 17:07:49,240 - src.agents.base - INFO - SingleAgent - LLM response (943 chars):
```json
{
  "status": "success",
  "vulnerability": "Arbitrary code execution via unsandboxed Jinja2 template rendering in DAG.get_doc_md (CWE-94, CWE-77, CWE-78).",
  "fix": "All template rendering is now performed in a sandboxed environment. For .md files, the file content is returned directly if possible, otherwise templates are rendered securely using the sandboxed environment.",
  "iterations": 3,
  "files_modified": ["airflow/models/dag.py"],
  "verification": {
    "poc_passed": true,
    "regression_passed": true
  }
}
```
**Summary:**  
- The vulnerability was due to using `jinja2.Template(doc_md)` (unsandboxed) for string templates, allowing code execution.
- The fix ensures all template rendering uses the sandboxed environment (`env.from_string`), and for `.md` files, the file content is returned directly if possible, matching expected behavior.
- All PoC and regression tests now pass. The patch is complete and secure.
2026-01-16 17:07:49,242 - orchestrator - INFO - Completed: Sample: CVE-2024-39877 | Status: success | Rounds: 3 | Duration: 116.5s
2026-01-16 17:07:49,242 - orchestrator - INFO - Completed: Sample: CVE-2024-39877 | Status: success | Rounds: 3 | Duration: 116.5s
2026-01-16 17:07:49,439 - __main__ - INFO - Extracted patch via /workspace/fix.patch (1305 bytes)
